<XQuery>(:~
 : Utility functions.
 :
 : @author Christian Gr√ºn, BaseX Team 2005-23, BSD License
 :)
<Module><LibraryModule><ModuleDecl><TOKEN>module</TOKEN> <TOKEN>namespace</TOKEN> <NCName><NCName>util</NCName></NCName> <TOKEN>=</TOKEN> <URILiteral><StringLiteral>'dba/util'</StringLiteral></URILiteral><Separator><TOKEN>;</TOKEN></Separator></ModuleDecl>

<Prolog><Import><ModuleImport><TOKEN>import</TOKEN> <TOKEN>module</TOKEN> <TOKEN>namespace</TOKEN> <NCName><NCName>options</NCName></NCName> <TOKEN>=</TOKEN> <URILiteral><StringLiteral>'dba/options'</StringLiteral></URILiteral> <TOKEN>at</TOKEN> <URILiteral><StringLiteral>'options.xqm'</StringLiteral></URILiteral></ModuleImport></Import><Separator><TOKEN>;</TOKEN></Separator>
<Import><ModuleImport><TOKEN>import</TOKEN> <TOKEN>module</TOKEN> <TOKEN>namespace</TOKEN> <NCName><NCName>config</NCName></NCName> <TOKEN>=</TOKEN> <URILiteral><StringLiteral>'dba/config'</StringLiteral></URILiteral> <TOKEN>at</TOKEN> <URILiteral><StringLiteral>'config.xqm'</StringLiteral></URILiteral></ModuleImport></Import><Separator><TOKEN>;</TOKEN></Separator>

(:~ Regular expression for backups. :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <VarDecl><TOKEN>variable</TOKEN> <TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>util:BACKUP-REGEX</QName></FunctionName></QName></EQName></VarName> <TOKEN>:=</TOKEN> <VarValue><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'^(.*)-(\d{4}-\d\d-\d\d)-(\d\d)-(\d\d)-(\d\d)$'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></VarValue></VarDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator>
(:~ Regular expression for backups. :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <VarDecl><TOKEN>variable</TOKEN> <TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>util:BACKUP-ZIP-REGEX</QName></FunctionName></QName></EQName></VarName> <TOKEN>:=</TOKEN> <VarValue><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'^(.*)-(\d{4}-\d\d-\d\d)-(\d\d)-(\d\d)-(\d\d)\.zip$'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></VarValue></VarDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator>

(:~
 : Evaluates a query and returns the result.
 : @param  $query    query string
 : @param  $context  initial context item (can be empty)
 : @return serialized result of query
 :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <EQName><QName><FunctionName><QName>util:query</QName></FunctionName></QName></EQName><TOKEN>(</TOKEN>
  <ParamList><Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>query</QName></FunctionName></QName></EQName>    <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:string</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType><OccurrenceIndicator><TOKEN>?</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN>
  <Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>context</QName></FunctionName></QName></EQName>  <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>?</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param></ParamList>
<TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:string</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType> <FunctionBody><EnclosedExpr><TOKEN>{</TOKEN>
  <Expr><ExprSingle><FLWORExpr><InitialClause><LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>bindings</QName></FunctionName></QName></EQName></VarName> <TOKEN>:=</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>context</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr> <TOKEN>!</TOKEN> <StepExpr><PostfixExpr><PrimaryExpr><MapConstructor><TOKEN>map</TOKEN> <TOKEN>{</TOKEN> <MapConstructorEntry><MapKeyExpr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>''</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></MapKeyExpr><TOKEN>:</TOKEN> <MapValueExpr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>context</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></MapValueExpr></MapConstructorEntry> <TOKEN>}</TOKEN></MapConstructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause>
  <IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>result</QName></FunctionName></QName></EQName></VarName> <TOKEN>:=</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>xquery:eval</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>query</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN> <Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>bindings</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN> <Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>util:query-options</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause>
  <ReturnClause><TOKEN>return</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>util:serialize</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>result</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator>

(:~
 : Runs an updating query.
 : @param  $query  query string
 : @return empty sequence
 :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <Annotation><TOKEN>%</TOKEN><EQName><QName><FunctionName><TOKEN>updating</TOKEN></FunctionName></QName></EQName></Annotation> <FunctionDecl><TOKEN>function</TOKEN> <EQName><QName><FunctionName><QName>util:update-query</QName></FunctionName></QName></EQName><TOKEN>(</TOKEN>
  <ParamList><Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>query</QName></FunctionName></QName></EQName>  <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:string</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType><OccurrenceIndicator><TOKEN>?</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param></ParamList>
<TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <SequenceType><TOKEN>empty-sequence</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></SequenceType> <FunctionBody><EnclosedExpr><TOKEN>{</TOKEN>
  <Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>xquery:eval-update</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>query</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN> <Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN> <Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>util:query-options</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN>
  
  <ExprSingle><FLWORExpr><InitialClause><LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>result</QName></FunctionName></QName></EQName></VarName> <TOKEN>:=</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>update:cache</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>true</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause>
  <ReturnClause><TOKEN>return</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>update:output</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>util:serialize</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>result</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator>

(:~
 : Finalizes the result of an evaluated query.
 : @param  $result  query result
 : @return empty sequence
 :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <EQName><QName><FunctionName><QName>util:serialize</QName></FunctionName></QName></EQName><TOKEN>(</TOKEN>
  <ParamList><Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>result</QName></FunctionName></QName></EQName>  <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>*</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param></ParamList>
<TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:string</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType> <FunctionBody><EnclosedExpr><TOKEN>{</TOKEN>
  (: serialize more characters than requested, because limit represents number of bytes :)
  <Expr><ExprSingle><FLWORExpr><InitialClause><LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>limit</QName></FunctionName></QName></EQName></VarName> <TOKEN>:=</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>options:get</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>options:MAXCHARS</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause>
  <IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>indent</QName></FunctionName></QName></EQName></VarName> <TOKEN>:=</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>options:get</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>options:INDENT</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause>
  <IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>string</QName></FunctionName></QName></EQName></VarName> <TOKEN>:=</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>serialize</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>result</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN> <Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><MapConstructor><TOKEN>map</TOKEN> <TOKEN>{</TOKEN>
    <MapConstructorEntry><MapKeyExpr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'limit'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></MapKeyExpr><TOKEN>:</TOKEN> <MapValueExpr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>limit</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr> <TOKEN>*</TOKEN> <UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>2</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr> <TOKEN>+</TOKEN> <MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></MapValueExpr></MapConstructorEntry><TOKEN>,</TOKEN>
    <MapConstructorEntry><MapKeyExpr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'method'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></MapKeyExpr><TOKEN>:</TOKEN> <MapValueExpr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'basex'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></MapValueExpr></MapConstructorEntry><TOKEN>,</TOKEN>
    <MapConstructorEntry><MapKeyExpr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'indent'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></MapKeyExpr><TOKEN>:</TOKEN> <MapValueExpr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>indent</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></MapValueExpr></MapConstructorEntry>
  <TOKEN>}</TOKEN></MapConstructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause>
  <ReturnClause><TOKEN>return</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>util:chop</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>string</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN> <Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>limit</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator>

(:~
 : Returns the options for evaluating a query.
 : @return options
 :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <Annotation><TOKEN>%</TOKEN><EQName><QName><FunctionName><QName>private</QName></FunctionName></QName></EQName></Annotation> <FunctionDecl><TOKEN>function</TOKEN> <EQName><QName><FunctionName><QName>util:query-options</QName></FunctionName></QName></EQName><TOKEN>(</TOKEN><TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <SequenceType><ItemType><MapTest><AnyMapTest><TOKEN>map</TOKEN><TOKEN>(</TOKEN><TOKEN>*</TOKEN><TOKEN>)</TOKEN></AnyMapTest></MapTest></ItemType></SequenceType> <FunctionBody><EnclosedExpr><TOKEN>{</TOKEN>
  <Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><MapConstructor><TOKEN>map</TOKEN> <TOKEN>{</TOKEN>
    <MapConstructorEntry><MapKeyExpr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'timeout'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></MapKeyExpr>   <TOKEN>:</TOKEN> <MapValueExpr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>options:get</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>options:TIMEOUT</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></MapValueExpr></MapConstructorEntry><TOKEN>,</TOKEN>
    <MapConstructorEntry><MapKeyExpr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'memory'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></MapKeyExpr>    <TOKEN>:</TOKEN> <MapValueExpr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>options:get</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>options:MEMORY</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></MapValueExpr></MapConstructorEntry><TOKEN>,</TOKEN>
    <MapConstructorEntry><MapKeyExpr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'permission'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></MapKeyExpr><TOKEN>:</TOKEN> <MapValueExpr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>options:get</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>options:PERMISSION</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></MapValueExpr></MapConstructorEntry><TOKEN>,</TOKEN>
    <MapConstructorEntry><MapKeyExpr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'base-uri'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></MapKeyExpr>  <TOKEN>:</TOKEN> <MapValueExpr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>config:directory</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr> <TOKEN>||</TOKEN> <RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'/'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr> <TOKEN>||</TOKEN> <RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>config:query</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></MapValueExpr></MapConstructorEntry>
  <TOKEN>}</TOKEN></MapConstructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator>

(:~
 : Returns the index of the first result to generate.
 : @param  $page  current page
 : @param  $sort  sort key
 : @return last result
 :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <EQName><QName><FunctionName><QName>util:start</QName></FunctionName></QName></EQName><TOKEN>(</TOKEN>
  <ParamList><Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>page</QName></FunctionName></QName></EQName>  <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:integer</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN>
  <Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>sort</QName></FunctionName></QName></EQName>  <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:string</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param></ParamList>
<TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:integer</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType> <FunctionBody><EnclosedExpr><TOKEN>{</TOKEN>
  <Expr><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>page</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr> <TOKEN>and</TOKEN> <ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>not</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>sort</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN> <TOKEN>then</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN>
    <Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>page</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr> <TOKEN>-</TOKEN> <MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr> <TOKEN>*</TOKEN> <UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>options:get</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>options:MAXROWS</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr> <TOKEN>+</TOKEN> <MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr>
  <TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle> <TOKEN>else</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN>
    <Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr>
  <TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></Expr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator>

(:~
 : Returns the index of the last result to generate.
 : @param  $page  current page
 : @param  $sort  sort key
 : @return last result
 :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <EQName><QName><FunctionName><QName>util:end</QName></FunctionName></QName></EQName><TOKEN>(</TOKEN>
  <ParamList><Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>page</QName></FunctionName></QName></EQName>  <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:integer</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN>
  <Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>sort</QName></FunctionName></QName></EQName>  <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:string</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param></ParamList>
<TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:integer</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType> <FunctionBody><EnclosedExpr><TOKEN>{</TOKEN>
  <Expr><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>page</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr> <TOKEN>and</TOKEN> <ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>not</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>sort</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN> <TOKEN>then</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN>
    <Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>page</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr> <TOKEN>*</TOKEN> <UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>options:get</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>options:MAXROWS</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr>
  <TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle> <TOKEN>else</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN>
    <Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>999999999</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr>
  <TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></Expr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator>

(:~
 : Chops a string result to the maximum number of allowed characters.
 : @param  $string  string
 : @param  $max     maximum number of characters
 : @return string
 :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <EQName><QName><FunctionName><QName>util:chop</QName></FunctionName></QName></EQName><TOKEN>(</TOKEN>
  <ParamList><Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>string</QName></FunctionName></QName></EQName>  <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:string</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN>
  <Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>max</QName></FunctionName></QName></EQName>     <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:integer</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param></ParamList>
<TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:string</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType> <FunctionBody><EnclosedExpr><TOKEN>{</TOKEN>
  <Expr><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>string-length</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>string</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr> <GeneralComp><TOKEN>&gt;</TOKEN></GeneralComp> <FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>max</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN> <TOKEN>then</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN>
    <Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>substring</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>string</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN> <Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN> <Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>max</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr> <TOKEN>||</TOKEN> <RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'...'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr>
  <TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle> <TOKEN>else</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN>
    <Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>string</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr>
  <TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></Expr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator>

(:~
 : Joins sequence entries.
 : @param  $items  items
 : @param  $sep    separator
 : @return result
 :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <EQName><QName><FunctionName><QName>util:item-join</QName></FunctionName></QName></EQName><TOKEN>(</TOKEN>
  <ParamList><Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>items</QName></FunctionName></QName></EQName>  <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>*</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN>
  <Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>sep</QName></FunctionName></QName></EQName>    <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType></SequenceType></TypeDeclaration></Param></ParamList>
<TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>*</TOKEN></OccurrenceIndicator></SequenceType> <FunctionBody><EnclosedExpr><TOKEN>{</TOKEN>
  <Expr><ExprSingle><FLWORExpr><InitialClause><ForClause><TOKEN>for</TOKEN> <ForBinding><TOKEN>$</TOKEN><VarName><EQName><QName><TOKEN>item</TOKEN></QName></EQName></VarName> <PositionalVar><TOKEN>at</TOKEN> <TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>pos</QName></FunctionName></QName></EQName></VarName></PositionalVar> <TOKEN>in</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>items</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ForBinding></ForClause></InitialClause>
  <ReturnClause><TOKEN>return</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>sep</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>pos</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr> <GeneralComp><TOKEN>&gt;</TOKEN></GeneralComp> <FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><TOKEN>item</TOKEN></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator>

(:~
 : Returns a count info for the specified items.
 : @param  $items   items
 : @param  $name    name of item (singular form)
 : @param  $action  action label (past tense)
 : @return result
 :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <EQName><QName><FunctionName><QName>util:info</QName></FunctionName></QName></EQName><TOKEN>(</TOKEN>
  <ParamList><Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>items</QName></FunctionName></QName></EQName>   <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>*</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN>
  <Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>name</QName></FunctionName></QName></EQName>    <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:string</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN>
  <Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>action</QName></FunctionName></QName></EQName>  <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:string</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param></ParamList>
<TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:string</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType> <FunctionBody><EnclosedExpr><TOKEN>{</TOKEN>
  <Expr><ExprSingle><FLWORExpr><InitialClause><LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><TOKEN>count</TOKEN></FunctionName></QName></EQName></VarName> <TOKEN>:=</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><TOKEN>count</TOKEN></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>items</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause>
  <ReturnClause><TOKEN>return</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><TOKEN>count</TOKEN></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr> <TOKEN>||</TOKEN> <RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>' '</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr> <TOKEN>||</TOKEN> <RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>name</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr> <TOKEN>||</TOKEN> <RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><Expr><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><TOKEN>count</TOKEN></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr> <GeneralComp><TOKEN>!=</TOKEN></GeneralComp> <FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN> <TOKEN>then</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'s were '</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle> <TOKEN>else</TOKEN> <ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>' was '</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></Expr><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr> <TOKEN>||</TOKEN> <RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>action</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr> <TOKEN>||</TOKEN> <RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'.'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator>

(:~
 : Capitalizes a string.
 : @param  $string  string
 : @return capitalized string
 :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <EQName><QName><FunctionName><QName>util:capitalize</QName></FunctionName></QName></EQName><TOKEN>(</TOKEN>
  <ParamList><Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>string</QName></FunctionName></QName></EQName>  <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:string</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param></ParamList>
<TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:string</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType> <FunctionBody><EnclosedExpr><TOKEN>{</TOKEN>
  <Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>upper-case</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>substring</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>string</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN> <Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN> <Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr> <TOKEN>||</TOKEN> <RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>substring</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>string</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN> <Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>2</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator>

(:~
 : Convenience function for redirecting to another page from update operations.
 : @param  $url     URL
 : @param  $params  query parameters
 :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <Annotation><TOKEN>%</TOKEN><EQName><QName><FunctionName><TOKEN>updating</TOKEN></FunctionName></QName></EQName></Annotation> <FunctionDecl><TOKEN>function</TOKEN> <EQName><QName><FunctionName><QName>util:redirect</QName></FunctionName></QName></EQName><TOKEN>(</TOKEN>
  <ParamList><Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>url</QName></FunctionName></QName></EQName>     <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><AtomicOrUnionType><EQName><QName><FunctionName><QName>xs:string</QName></FunctionName></QName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN>
  <Param><TOKEN>$</TOKEN><EQName><QName><FunctionName><QName>params</QName></FunctionName></QName></EQName>  <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ItemType><MapTest><AnyMapTest><TOKEN>map</TOKEN><TOKEN>(</TOKEN><TOKEN>*</TOKEN><TOKEN>)</TOKEN></AnyMapTest></MapTest></ItemType></SequenceType></TypeDeclaration></Param></ParamList>
<TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <SequenceType><TOKEN>empty-sequence</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></SequenceType> <FunctionBody><EnclosedExpr><TOKEN>{</TOKEN>
  <Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>update:output</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionEQName><FunctionName><QName>web:redirect</QName></FunctionName></FunctionEQName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>url</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN> <Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><FTContainsExpr><StringConcatExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><TransformWithExpr><BasexUpdate1Expr><BasexUpdateExpr><ArrowExpr><UnaryExpr><ValueExpr><SimpleMapExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><QName><FunctionName><QName>params</QName></FunctionName></QName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></SimpleMapExpr></ValueExpr></UnaryExpr></ArrowExpr></BasexUpdateExpr></BasexUpdate1Expr></TransformWithExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></StringConcatExpr></FTContainsExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator></Prolog></LibraryModule></Module>
<EOF/></XQuery>