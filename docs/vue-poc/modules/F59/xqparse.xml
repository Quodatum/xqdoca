<XQuery>(:~ 
 : generate xquery access code for entity definitions
 :)
<LibraryModule><ModuleDecl><TOKEN>module</TOKEN> <TOKEN>namespace</TOKEN> <NCName>bf</NCName> <TOKEN>=</TOKEN> <StringLiteral>'quodatum.tools.buildfields'</StringLiteral><TOKEN>;</TOKEN></ModuleDecl>
<Prolog><DefaultNamespaceDecl><TOKEN>declare</TOKEN> <TOKEN>default</TOKEN> <TOKEN>function</TOKEN> <TOKEN>namespace</TOKEN> <StringLiteral>'quodatum.tools.buildfields'</StringLiteral></DefaultNamespaceDecl><TOKEN>;</TOKEN> 
<NamespaceDecl><TOKEN>declare</TOKEN> <TOKEN>namespace</TOKEN> <NCName>ent</NCName><TOKEN>=</TOKEN><StringLiteral>"https://github.com/Quodatum/app-doc/entity"</StringLiteral></NamespaceDecl><TOKEN>;</TOKEN> 


(:~
 : generate xquery module for given entities as a string
 :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <TOKEN>module</TOKEN><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><QName>entities</QName> <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><QName>ent:entity</QName><TOKEN>)</TOKEN></ElementTest><TOKEN>*</TOKEN></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><QName>imports</QName></Param></ParamList><TOKEN>)</TOKEN>
<TOKEN>as</TOKEN> <QName>xs:string</QName>
<EnclosedExpr><TOKEN>{</TOKEN>
<FLWORExpr><LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>src</QName><TOKEN>:=</TOKEN> <DirElemConstructor><TOKEN>&lt;</TOKEN><TOKEN>text</TOKEN><DirAttributeList/><TOKEN>&gt;</TOKEN><ElementContentChar>(</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>y</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>p</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>u</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>g</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>d</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>x</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>d</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><FunctionCall><QName>fn:current-dateTime</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar> </ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar>)</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>d</ElementContentChar><ElementContentChar>u</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>p</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>y</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>=</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>'</ElementContentChar><ElementContentChar>q</ElementContentChar><ElementContentChar>u</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>d</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>u</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>.</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>d</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>.</ElementContentChar><ElementContentChar>g</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>d</ElementContentChar><ElementContentChar>'</ElementContentChar><ElementContentChar>;</ElementContentChar><ElementContentChar>
</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><VarRef><TOKEN>$</TOKEN><QName>imports</QName></VarRef><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>
</ElementContentChar><ElementContentChar>
</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><FunctionCall><QName>bf:build-imports</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>entities</QName></VarRef><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>
</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><FunctionCall><QName>bf:build-namespaces</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>entities</QName></VarRef><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>
</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><ParenthesizedExpr><TOKEN>(</TOKEN>  <FunctionCall><QName>bf:build-describe</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>entities</QName></VarRef><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>)</TOKEN></ParenthesizedExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar> </ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar>(</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar>~</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>p</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>u</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>y</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar>)</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar>d</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>u</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>y</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>d</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>(</ElementContentChar><ElementContentChar>$</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>y</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>x</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>g</ElementContentChar><ElementContentChar>)</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>p</ElementContentChar><ElementContentChar>(</ElementContentChar><ElementContentChar>*</ElementContentChar><ElementContentChar>)</ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>$</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>y</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>(</ElementContentChar><ElementContentChar>$</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>y</ElementContentChar><ElementContentChar>)</ElementContentChar><ElementContentChar>(</ElementContentChar><ElementContentChar>"</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>"</ElementContentChar><ElementContentChar>)</ElementContentChar><ElementContentChar>
</ElementContentChar><TOKEN>}}</TOKEN><ElementContentChar>;</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><TOKEN>&lt;/</TOKEN><TOKEN>text</TOKEN><TOKEN>&gt;</TOKEN></DirElemConstructor></LetBinding></LetClause> 

 <ReturnClause><TOKEN>return</TOKEN> <VarRef><TOKEN>$</TOKEN><QName>src</QName></VarRef></ReturnClause></FLWORExpr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionDecl></AnnotatedDecl><TOKEN>;</TOKEN>

(:~
 : generate xquery for to return field value in the format: "name":function($_){}
 :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <QName>accessfn</QName><TOKEN>(</TOKEN><Param><TOKEN>$</TOKEN><QName>f</QName> <TypeDeclaration><TOKEN>as</TOKEN> <ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><QName>ent:field</QName><TOKEN>)</TOKEN></ElementTest></TypeDeclaration></Param><TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <QName>xs:string</QName>
<EnclosedExpr><TOKEN>{</TOKEN>
<FLWORExpr><LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>type</QName><TOKEN>:=</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>f</QName></VarRef><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>type</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>/</TOKEN><FunctionCall><QName>fn:string</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr></LetBinding></LetClause>
<ReturnClause><TOKEN>return</TOKEN> <DirElemConstructor><TOKEN>&lt;</TOKEN><QName>field</QName><DirAttributeList/><TOKEN>&gt;</TOKEN><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>"</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>f</QName></VarRef><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>name</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>/</TOKEN><FunctionCall><QName>fn:string</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>"</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>u</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>(</ElementContentChar><ElementContentChar>$</ElementContentChar><ElementContentChar>_</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>(</ElementContentChar><ElementContentChar>)</ElementContentChar><ElementContentChar>)</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><VarRef><TOKEN>$</TOKEN><QName>type</QName></VarRef><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar> </ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar>$</ElementContentChar><ElementContentChar>_</ElementContentChar><ElementContentChar>/</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>f</QName></VarRef><TOKEN>/</TOKEN><AxisStep><QName>ent:xpath</QName> <PredicateList/></AxisStep></RelativePathExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar> </ElementContentChar><TOKEN>}}</TOKEN><TOKEN>&lt;/</TOKEN><QName>field</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></ReturnClause></FLWORExpr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionDecl></AnnotatedDecl><TOKEN>;</TOKEN>

<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <QName>generate</QName><TOKEN>(</TOKEN><Param><TOKEN>$</TOKEN><QName>e</QName> <TypeDeclaration><TOKEN>as</TOKEN> <ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><QName>ent:entity</QName><TOKEN>)</TOKEN></ElementTest></TypeDeclaration></Param><TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <QName>xs:string</QName>
<EnclosedExpr><TOKEN>{</TOKEN>
  <FLWORExpr><LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>fields</QName><TOKEN>:=</TOKEN><FLWORExpr><ForClause><TOKEN>for</TOKEN> <ForBinding><TOKEN>$</TOKEN><QName>field</QName> <TOKEN>in</TOKEN> <RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>e</QName></VarRef><TOKEN>/</TOKEN><AxisStep><QName>ent:fields</QName><PredicateList/></AxisStep><TOKEN>/</TOKEN><AxisStep><QName>ent:field</QName>   
                <PredicateList/></AxisStep></RelativePathExpr></ForBinding></ForClause><OrderByClause><TOKEN>order</TOKEN> <TOKEN>by</TOKEN> <OrderSpec><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>field</QName></VarRef><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>name</QName></AbbrevForwardStep>
                <PredicateList/></AxisStep></RelativePathExpr><OrderModifier/></OrderSpec></OrderByClause><ReturnClause><TOKEN>return</TOKEN> <VarRef><TOKEN>$</TOKEN><QName>field</QName></VarRef></ReturnClause></FLWORExpr></LetBinding></LetClause>
                
  <LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>filter</QName><TOKEN>:=</TOKEN><ArrowExpr><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>e</QName></VarRef><TOKEN>/</TOKEN><AxisStep><QName>ent:views</QName><PredicateList/></AxisStep><TOKEN>/</TOKEN><AxisStep><QName>ent:view</QName><Predicate><TOKEN>[</TOKEN><ComparisonExpr><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>name</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>=</TOKEN><StringLiteral>"filter"</StringLiteral></ComparisonExpr><TOKEN>]</TOKEN></Predicate></AxisStep></RelativePathExpr><TOKEN>=&gt;</TOKEN><QName>fn:tokenize</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></ArrowExpr></LetBinding></LetClause>
  <LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>filter</QName><TOKEN>:=</TOKEN> <RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>e</QName></VarRef><TOKEN>/</TOKEN><AxisStep><QName>ent:fields</QName><PredicateList/></AxisStep><TOKEN>/</TOKEN><AxisStep><QName>ent:field</QName><Predicate><TOKEN>[</TOKEN><ComparisonExpr><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>name</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>=</TOKEN><VarRef><TOKEN>$</TOKEN><QName>filter</QName></VarRef></ComparisonExpr><TOKEN>]</TOKEN></Predicate></AxisStep><TOKEN>/</TOKEN><AxisStep><QName>ent:xpath</QName><PredicateList/></AxisStep><TOKEN>/</TOKEN><FunctionCall><QName>fn:concat</QName><ArgumentList><TOKEN>(</TOKEN><StringLiteral>"$item/"</StringLiteral><TOKEN>,</TOKEN><TOKEN>.</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr></LetBinding></LetClause> 
                   
  <ReturnClause><TOKEN>return</TOKEN> <DirElemConstructor><TOKEN>&lt;</TOKEN><QName>field</QName><DirAttributeList/><TOKEN>&gt;</TOKEN><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>"</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>e</QName></VarRef><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>name</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>/</TOKEN><FunctionCall><QName>fn:string</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>"</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>p</ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>"</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>"</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>"</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN> <RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>e</QName></VarRef><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>name</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>/</TOKEN><FunctionCall><QName>fn:string</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>"</ElementContentChar><ElementContentChar>,</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>"</ElementContentChar><ElementContentChar>d</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>p</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>"</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>"</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN> <FunctionCall><QName>escape</QName><ArgumentList><TOKEN>(</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>e</QName></VarRef><TOKEN>/</TOKEN><AxisStep><QName>ent:description</QName><PredicateList/></AxisStep></RelativePathExpr><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>"</ElementContentChar><ElementContentChar>,</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>"</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>"</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>p</ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><ArrowExpr><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>fields</QName></VarRef><TOKEN>!</TOKEN><FunctionCall><QName>accessfn</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>.</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr><TOKEN>=&gt;</TOKEN><QName>fn:string-join</QName><ArgumentList><TOKEN>(</TOKEN><StringLiteral>","</StringLiteral><TOKEN>)</TOKEN></ArgumentList></ArrowExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar> </ElementContentChar><TOKEN>}}</TOKEN><ElementContentChar>,</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>"</ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>"</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>u</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>(</ElementContentChar><ElementContentChar>$</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>,</ElementContentChar><ElementContentChar>$</ElementContentChar><ElementContentChar>q</ElementContentChar><ElementContentChar>)</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>x</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar>b</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>n</ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar> </ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>$</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>(</ElementContentChar><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><FunctionCall><QName>fn:string-join</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>filter</QName></VarRef><TOKEN>,</TOKEN><StringLiteral>", "</StringLiteral><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>)</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>(</ElementContentChar><ElementContentChar>$</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>,</ElementContentChar><ElementContentChar>$</ElementContentChar><ElementContentChar>q</ElementContentChar><ElementContentChar>,</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>'</ElementContentChar><ElementContentChar>h</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>p</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar>/</ElementContentChar><ElementContentChar>/</ElementContentChar><ElementContentChar>w</ElementContentChar><ElementContentChar>w</ElementContentChar><ElementContentChar>w</ElementContentChar><ElementContentChar>.</ElementContentChar><ElementContentChar>w</ElementContentChar><ElementContentChar>3</ElementContentChar><ElementContentChar>.</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>g</ElementContentChar><ElementContentChar>/</ElementContentChar><ElementContentChar>2</ElementContentChar><ElementContentChar>0</ElementContentChar><ElementContentChar>0</ElementContentChar><ElementContentChar>5</ElementContentChar><ElementContentChar>/</ElementContentChar><ElementContentChar>x</ElementContentChar><ElementContentChar>p</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>h</ElementContentChar><ElementContentChar>-</ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>u</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>/</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>/</ElementContentChar><ElementContentChar>h</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>-</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>-</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>-</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>v</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>'</ElementContentChar><ElementContentChar>)</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><TOKEN>}}</TOKEN><ElementContentChar>,</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>"</ElementContentChar><ElementContentChar>j</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>"</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>p</ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><ArrowExpr><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>fields</QName></VarRef><TOKEN>!</TOKEN><FunctionCall><QName>jsonfn</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>.</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr><TOKEN>=&gt;</TOKEN><QName>fn:string-join</QName><ArgumentList><TOKEN>(</TOKEN><StringLiteral>","</StringLiteral><TOKEN>)</TOKEN></ArgumentList></ArrowExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar> </ElementContentChar><TOKEN>}}</TOKEN><ElementContentChar>,</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>"</ElementContentChar><ElementContentChar>d</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>"</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>u</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>(</ElementContentChar><ElementContentChar>)</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>e</QName></VarRef><TOKEN>/</TOKEN><AxisStep><QName>ent:data</QName><PredicateList/></AxisStep><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>type</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>/</TOKEN><FunctionCall><QName>fn:string</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>.</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>*</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><FLWORExpr><LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>a</QName><TOKEN>:=</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>e</QName></VarRef><TOKEN>/</TOKEN><AxisStep><QName>ent:data</QName><PredicateList/></AxisStep><TOKEN>/</TOKEN><FunctionCall><QName>fn:string</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr></LetBinding></LetClause> <ReturnClause><TOKEN>return</TOKEN> <IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>a</QName></VarRef><TOKEN>)</TOKEN><TOKEN>then</TOKEN> <VarRef><TOKEN>$</TOKEN><QName>a</QName></VarRef> <TOKEN>else</TOKEN> <StringLiteral>"()"</StringLiteral></IfExpr></ReturnClause></FLWORExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar> </ElementContentChar><TOKEN>}}</TOKEN><ElementContentChar>,</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>"</ElementContentChar><ElementContentChar>v</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>w</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>"</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>p</ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar> </ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><ArrowExpr><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>e</QName></VarRef><TOKEN>/</TOKEN><AxisStep><QName>ent:views</QName><PredicateList/></AxisStep><TOKEN>/</TOKEN><AxisStep><QName>ent:view</QName><PredicateList/></AxisStep><TOKEN>!</TOKEN><ParenthesizedExpr><TOKEN>(</TOKEN><StringConcatExpr><StringLiteral>"'"</StringLiteral> <TOKEN>||</TOKEN> <AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>name</QName></AbbrevForwardStep> <PredicateList/></AxisStep><TOKEN>||</TOKEN> <StringLiteral>"': '"</StringLiteral> <TOKEN>||</TOKEN><TOKEN>.</TOKEN> <TOKEN>||</TOKEN> <StringLiteral>"'"</StringLiteral></StringConcatExpr><TOKEN>)</TOKEN></ParenthesizedExpr></RelativePathExpr><TOKEN>=&gt;</TOKEN><QName>fn:string-join</QName><ArgumentList><TOKEN>(</TOKEN><StringLiteral>','</StringLiteral><TOKEN>)</TOKEN></ArgumentList></ArrowExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><TOKEN>}}</TOKEN><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><TOKEN>}}</TOKEN><TOKEN>&lt;/</TOKEN><QName>field</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></ReturnClause></FLWORExpr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionDecl></AnnotatedDecl><TOKEN>;</TOKEN>

(:~
 : @return sequence of element(entity) items for definitions at path
 :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <QName>entities</QName><TOKEN>(</TOKEN><Param><TOKEN>$</TOKEN><QName>path</QName> <TypeDeclaration><TOKEN>as</TOKEN> <QName>xs:string</QName></TypeDeclaration></Param><TOKEN>)</TOKEN> 
<TOKEN>as</TOKEN> <SequenceType><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><QName>ent:entity</QName><TOKEN>)</TOKEN></ElementTest><TOKEN>*</TOKEN></SequenceType>
<EnclosedExpr><TOKEN>{</TOKEN>
<FLWORExpr><LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>_</QName><TOKEN>:=</TOKEN><FunctionCall><QName>fn:trace</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>path</QName></VarRef><TOKEN>,</TOKEN><StringLiteral>"DD"</StringLiteral><TOKEN>)</TOKEN></ArgumentList></FunctionCall></LetBinding></LetClause>
 <LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>p</QName><TOKEN>:=</TOKEN><StringConcatExpr><FunctionCall><QName>fn:resolve-uri</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>path</QName></VarRef><TOKEN>)</TOKEN></ArgumentList></FunctionCall> <TOKEN>||</TOKEN> <StringLiteral>"/"</StringLiteral></StringConcatExpr></LetBinding></LetClause>
 <ReturnClause><TOKEN>return</TOKEN> <FLWORExpr><ForClause><TOKEN>for</TOKEN> <ForBinding><TOKEN>$</TOKEN><QName>f</QName> <TOKEN>in</TOKEN> <FunctionCall><QName>file:list</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>p</QName></VarRef><TOKEN>)</TOKEN></ArgumentList></FunctionCall></ForBinding></ForClause>
        <OrderByClause><TOKEN>order</TOKEN> <TOKEN>by</TOKEN> <OrderSpec><VarRef><TOKEN>$</TOKEN><QName>f</QName></VarRef>
        <OrderModifier/></OrderSpec></OrderByClause><ReturnClause><TOKEN>return</TOKEN> <RelativePathExpr><FunctionCall><QName>fn:doc</QName><ArgumentList><TOKEN>(</TOKEN><FunctionCall><QName>fn:concat</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>p</QName></VarRef><TOKEN>,</TOKEN><VarRef><TOKEN>$</TOKEN><QName>f</QName></VarRef><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>/</TOKEN><AxisStep><QName>ent:entity</QName>
<PredicateList/></AxisStep></RelativePathExpr></ReturnClause></FLWORExpr></ReturnClause></FLWORExpr><TOKEN>}</TOKEN></EnclosedExpr></FunctionDecl></AnnotatedDecl><TOKEN>;</TOKEN>

(:map for entity :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <QName>build-map</QName><TOKEN>(</TOKEN><Param><TOKEN>$</TOKEN><QName>entity</QName> <TypeDeclaration><TOKEN>as</TOKEN> <ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><QName>ent:entity</QName><TOKEN>)</TOKEN></ElementTest></TypeDeclaration></Param><TOKEN>)</TOKEN> 
<TOKEN>as</TOKEN> <QName>xs:string</QName>
<EnclosedExpr><TOKEN>{</TOKEN>
<FLWORExpr><LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>m</QName><TOKEN>:=</TOKEN><FLWORExpr><ForClause><TOKEN>for</TOKEN> <ForBinding><TOKEN>$</TOKEN><QName>field</QName> <TOKEN>in</TOKEN> <RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>entity</QName></VarRef><TOKEN>/</TOKEN><AxisStep><QName>ent:fields</QName><PredicateList/></AxisStep><TOKEN>/</TOKEN><AxisStep><QName>ent:field</QName>   
        <PredicateList/></AxisStep></RelativePathExpr></ForBinding></ForClause><OrderByClause><TOKEN>order</TOKEN> <TOKEN>by</TOKEN> <OrderSpec><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>field</QName></VarRef><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>name</QName></AbbrevForwardStep>
        <PredicateList/></AxisStep></RelativePathExpr><OrderModifier/></OrderSpec></OrderByClause><ReturnClause><TOKEN>return</TOKEN> <FunctionCall><QName>accessfn</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>field</QName></VarRef><TOKEN>)</TOKEN></ArgumentList></FunctionCall></ReturnClause></FLWORExpr></LetBinding></LetClause>
<ReturnClause><TOKEN>return</TOKEN> <DirElemConstructor><TOKEN>&lt;</TOKEN><TOKEN>text</TOKEN><DirAttributeList/><TOKEN>&gt;</TOKEN><ElementContentChar>
</ElementContentChar><ElementContentChar>d</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>v</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>b</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>$</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>y</ElementContentChar><ElementContentChar>:</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>entity</QName></VarRef><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>name</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>/</TOKEN><FunctionCall><QName>fn:string</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>:</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>p</ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><FunctionCall><QName>fn:string-join</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>m</QName></VarRef><TOKEN>,</TOKEN><StringLiteral>","</StringLiteral><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>
</ElementContentChar><TOKEN>}}</TOKEN><ElementContentChar>;</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar>
</ElementContentChar><TOKEN>&lt;/</TOKEN><TOKEN>text</TOKEN><TOKEN>&gt;</TOKEN></DirElemConstructor></ReturnClause></FLWORExpr>        
<TOKEN>}</TOKEN></EnclosedExpr></FunctionDecl></AnnotatedDecl><TOKEN>;</TOKEN>

(:~ 
 :  return xml for suitable json serialization for field 
:)
<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <QName>jsonfn</QName><TOKEN>(</TOKEN><Param><TOKEN>$</TOKEN><QName>f</QName> <TypeDeclaration><TOKEN>as</TOKEN> <ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><QName>ent:field</QName><TOKEN>)</TOKEN></ElementTest></TypeDeclaration></Param><TOKEN>)</TOKEN> 
<TOKEN>as</TOKEN> <QName>xs:string</QName>
<EnclosedExpr><TOKEN>{</TOKEN>
    <FLWORExpr><LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>name</QName><TOKEN>:=</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>f</QName></VarRef><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>name</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>/</TOKEN><FunctionCall><QName>fn:string</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr></LetBinding></LetClause>
    <LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>type</QName><TOKEN>:=</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>f</QName></VarRef><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>type</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>/</TOKEN><FunctionCall><QName>fn:string</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr></LetBinding></LetClause>
    <LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>opt</QName><TOKEN>:=</TOKEN><FunctionCall><QName>fn:contains</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>type</QName></VarRef><TOKEN>,</TOKEN><StringLiteral>"?"</StringLiteral><TOKEN>)</TOKEN></ArgumentList></FunctionCall></LetBinding></LetClause>
    <LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>repeat</QName><TOKEN>:=</TOKEN><FunctionCall><QName>fn:contains</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>type</QName></VarRef><TOKEN>,</TOKEN><StringLiteral>"*"</StringLiteral><TOKEN>)</TOKEN></ArgumentList></FunctionCall></LetBinding></LetClause>
    <LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>json-type</QName><TOKEN>:=</TOKEN><FunctionCall><QName>json-type</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>type</QName></VarRef><TOKEN>)</TOKEN></ArgumentList></FunctionCall></LetBinding></LetClause>
    <LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>mult</QName><TOKEN>:=</TOKEN><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>repeat</QName></VarRef><TOKEN>)</TOKEN> <TOKEN>then</TOKEN> <StringLiteral>"*"</StringLiteral> <TOKEN>else</TOKEN> <StringLiteral>"?"</StringLiteral></IfExpr></LetBinding></LetClause>
    
    <LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><TOKEN>at</TOKEN><TOKEN>:=</TOKEN><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><ComparisonExpr><VarRef><TOKEN>$</TOKEN><QName>json-type</QName></VarRef> <TOKEN>ne</TOKEN> <StringLiteral>"string"</StringLiteral></ComparisonExpr><TOKEN>)</TOKEN> 
            <TOKEN>then</TOKEN> <StringConcatExpr><StringLiteral>"attribute type {'"</StringLiteral> <TOKEN>||</TOKEN> <VarRef><TOKEN>$</TOKEN><QName>json-type</QName></VarRef> <TOKEN>||</TOKEN> <StringLiteral>"'},"</StringLiteral></StringConcatExpr>
            <TOKEN>else</TOKEN> <StringLiteral>""</StringLiteral></IfExpr></LetBinding></LetClause> 
    (: generate json xml :)
    <LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>simple</QName><TOKEN>:=</TOKEN><InlineFunctionExpr><TOKEN>function</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <QName>xs:string</QName><EnclosedExpr><TOKEN>{</TOKEN>
                <DirElemConstructor><TOKEN>&lt;</TOKEN><QName>field</QName><DirAttributeList/><TOKEN>&gt;</TOKEN><ElementContentChar>(</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><VarRef><TOKEN>$</TOKEN><QName>type</QName></VarRef><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar> </ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar>)</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar>d</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>(</ElementContentChar><ElementContentChar>$</ElementContentChar><ElementContentChar>_</ElementContentChar><ElementContentChar>/</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>f</QName></VarRef><TOKEN>/</TOKEN><AxisStep><QName>ent:xpath</QName> <PredicateList/></AxisStep></RelativePathExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>)</ElementContentChar><ElementContentChar>!</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><VarRef><TOKEN>$</TOKEN><QName>name</QName></VarRef><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar> </ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><VarRef><TOKEN>$</TOKEN><TOKEN>at</TOKEN></VarRef><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar> </ElementContentChar><ElementContentChar>.</ElementContentChar><TOKEN>}}</TOKEN><ElementContentChar> </ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><TOKEN>&lt;/</TOKEN><QName>field</QName><TOKEN>&gt;</TOKEN></DirElemConstructor>
                <TOKEN>}</TOKEN></EnclosedExpr></InlineFunctionExpr></LetBinding></LetClause>
    <LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><TOKEN>array</TOKEN><TOKEN>:=</TOKEN><InlineFunctionExpr><TOKEN>function</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <QName>xs:string</QName><EnclosedExpr><TOKEN>{</TOKEN>
                <DirElemConstructor><TOKEN>&lt;</TOKEN><QName>field</QName><DirAttributeList/><TOKEN>&gt;</TOKEN><ElementContentChar>(</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>y</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>g</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar>)</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><VarRef><TOKEN>$</TOKEN><QName>name</QName></VarRef><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar> </ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar> </ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>b</ElementContentChar><ElementContentChar>u</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>y</ElementContentChar><ElementContentChar>p</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar>"</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>y</ElementContentChar><ElementContentChar>"</ElementContentChar><TOKEN>}}</TOKEN><ElementContentChar>,</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>$</ElementContentChar><ElementContentChar>_</ElementContentChar><ElementContentChar>/</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>f</QName></VarRef><TOKEN>/</TOKEN><AxisStep><QName>ent:xpath</QName> <PredicateList/></AxisStep></RelativePathExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>!</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>_</ElementContentChar><ElementContentChar> </ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar> </ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>b</ElementContentChar><ElementContentChar>u</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>y</ElementContentChar><ElementContentChar>p</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar>"</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>g</ElementContentChar><ElementContentChar>"</ElementContentChar><TOKEN>}}</TOKEN><ElementContentChar>,</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>.</ElementContentChar><TOKEN>}}</TOKEN><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><TOKEN>}}</TOKEN><ElementContentChar> </ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><TOKEN>&lt;/</TOKEN><QName>field</QName><TOKEN>&gt;</TOKEN></DirElemConstructor>
                <TOKEN>}</TOKEN></EnclosedExpr></InlineFunctionExpr></LetBinding></LetClause>            
    (: serialize when element :)
    <LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><TOKEN>element</TOKEN><TOKEN>:=</TOKEN><InlineFunctionExpr><TOKEN>function</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <QName>xs:string</QName><EnclosedExpr><TOKEN>{</TOKEN>
                <DirElemConstructor><TOKEN>&lt;</TOKEN><QName>field</QName><DirAttributeList/><TOKEN>&gt;</TOKEN><ElementContentChar>e</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><VarRef><TOKEN>$</TOKEN><QName>name</QName></VarRef><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar> </ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar> </ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>b</ElementContentChar><ElementContentChar>u</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>y</ElementContentChar><ElementContentChar>p</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar>"</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>g</ElementContentChar><ElementContentChar>"</ElementContentChar><TOKEN>}}</TOKEN><ElementContentChar>,</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>z</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>(</ElementContentChar><ElementContentChar>$</ElementContentChar><ElementContentChar>_</ElementContentChar><ElementContentChar>/</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>f</QName></VarRef><TOKEN>/</TOKEN><AxisStep><QName>ent:xpath</QName><PredicateList/></AxisStep></RelativePathExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>)</ElementContentChar><TOKEN>}}</TOKEN><TOKEN>&lt;/</TOKEN><QName>field</QName><TOKEN>&gt;</TOKEN></DirElemConstructor>
                <TOKEN>}</TOKEN></EnclosedExpr></InlineFunctionExpr></LetBinding></LetClause> 
                    
    <ReturnClause><TOKEN>return</TOKEN> <DirElemConstructor><TOKEN>&lt;</TOKEN><QName>field</QName><DirAttributeList/><TOKEN>&gt;</TOKEN><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>"</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><VarRef><TOKEN>$</TOKEN><QName>name</QName></VarRef><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>"</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>f</ElementContentChar><ElementContentChar>u</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>(</ElementContentChar><ElementContentChar>$</ElementContentChar><ElementContentChar>_</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>(</ElementContentChar><ElementContentChar>)</ElementContentChar><ElementContentChar>)</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>(</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><VarRef><TOKEN>$</TOKEN><QName>name</QName></VarRef><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>)</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><VarRef><TOKEN>$</TOKEN><QName>mult</QName></VarRef><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar> </ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar>
</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>repeat</QName></VarRef><TOKEN>)</TOKEN><TOKEN>then</TOKEN>
             <PostfixExpr><VarRef><TOKEN>$</TOKEN><TOKEN>array</TOKEN></VarRef><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></PostfixExpr> 
            <TOKEN>else</TOKEN> <IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><ComparisonExpr><VarRef><TOKEN>$</TOKEN><QName>type</QName></VarRef><TOKEN>=</TOKEN><StringLiteral>"element()"</StringLiteral></ComparisonExpr><TOKEN>)</TOKEN> <TOKEN>then</TOKEN> 
               <PostfixExpr><VarRef><TOKEN>$</TOKEN><TOKEN>element</TOKEN></VarRef><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></PostfixExpr> 
             <TOKEN>else</TOKEN> <PostfixExpr><VarRef><TOKEN>$</TOKEN><QName>simple</QName></VarRef><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></PostfixExpr></IfExpr></IfExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar> </ElementContentChar><TOKEN>}}</TOKEN><TOKEN>&lt;/</TOKEN><QName>field</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></ReturnClause></FLWORExpr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionDecl></AnnotatedDecl><TOKEN>;</TOKEN>


(:~ convert xs type to json
:)
<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <QName>json-type</QName><TOKEN>(</TOKEN><Param><TOKEN>$</TOKEN><QName>xsd</QName> <TypeDeclaration><TOKEN>as</TOKEN> <QName>xs:string</QName></TypeDeclaration></Param><TOKEN>)</TOKEN> <TOKEN>as</TOKEN> <QName>xs:string</QName><EnclosedExpr><TOKEN>{</TOKEN>
<SwitchExpr><TOKEN>switch</TOKEN> <TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>xsd</QName></VarRef><TOKEN>)</TOKEN>
   <SwitchCaseClause><TOKEN>case</TOKEN> <StringLiteral>"element()"</StringLiteral> <TOKEN>return</TOKEN> <StringLiteral>"string"</StringLiteral></SwitchCaseClause> 
   <SwitchCaseClause><TOKEN>case</TOKEN> <StringLiteral>"xs:boolean"</StringLiteral> <TOKEN>return</TOKEN> <StringLiteral>"boolean"</StringLiteral></SwitchCaseClause>
   <SwitchCaseClause><TOKEN>case</TOKEN> <StringLiteral>"xs:integer"</StringLiteral> <TOKEN>return</TOKEN> <StringLiteral>"number"</StringLiteral></SwitchCaseClause>
   <SwitchCaseClause><TOKEN>case</TOKEN> <StringLiteral>"xs:float"</StringLiteral> <TOKEN>return</TOKEN> <StringLiteral>"number"</StringLiteral></SwitchCaseClause>
   <SwitchCaseClause><TOKEN>case</TOKEN> <StringLiteral>"xs:double"</StringLiteral> <TOKEN>return</TOKEN> <StringLiteral>"number"</StringLiteral></SwitchCaseClause>
   <SwitchCaseClause><TOKEN>case</TOKEN> <StringLiteral>"xs:string*"</StringLiteral> <TOKEN>return</TOKEN> <StringLiteral>"array"</StringLiteral></SwitchCaseClause>
   <TOKEN>default</TOKEN> <TOKEN>return</TOKEN> <StringLiteral>"string"</StringLiteral></SwitchExpr> 
<TOKEN>}</TOKEN></EnclosedExpr></FunctionDecl></AnnotatedDecl><TOKEN>;</TOKEN>

(:~ declare any namespaces found :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <QName>build-namespaces</QName><TOKEN>(</TOKEN><Param><TOKEN>$</TOKEN><QName>entities</QName> <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ElementTest><TOKEN>*</TOKEN></SequenceType></TypeDeclaration></Param><TOKEN>)</TOKEN>
<EnclosedExpr><TOKEN>{</TOKEN>
  <FLWORExpr><ForClause><TOKEN>for</TOKEN> <ForBinding><TOKEN>$</TOKEN><QName>n</QName> <TOKEN>in</TOKEN> <FunctionCall><QName>distinct-deep</QName><ArgumentList><TOKEN>(</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>entities</QName></VarRef><TOKEN>/</TOKEN><AxisStep><QName>ent:namespace</QName><PredicateList/></AxisStep></RelativePathExpr><TOKEN>)</TOKEN></ArgumentList></FunctionCall></ForBinding></ForClause>
  <ReturnClause><TOKEN>return</TOKEN> 
<DirElemConstructor><TOKEN>&lt;</TOKEN><TOKEN>text</TOKEN><DirAttributeList/><TOKEN>&gt;</TOKEN><ElementContentChar>d</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>p</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>n</QName></VarRef><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>prefix</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>/</TOKEN><FunctionCall><QName>fn:string</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>=</ElementContentChar><ElementContentChar>'</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>n</QName></VarRef><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>uri</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>/</TOKEN><FunctionCall><QName>fn:string</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>'</ElementContentChar><ElementContentChar>;</ElementContentChar><ElementContentChar>
</ElementContentChar><TOKEN>&lt;/</TOKEN><TOKEN>text</TOKEN><TOKEN>&gt;</TOKEN></DirElemConstructor></ReturnClause></FLWORExpr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionDecl></AnnotatedDecl><TOKEN>;</TOKEN>

(:~ import any modules found must be in repo :)
<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <QName>build-imports</QName><TOKEN>(</TOKEN><Param><TOKEN>$</TOKEN><QName>entities</QName> <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ElementTest><TOKEN>*</TOKEN></SequenceType></TypeDeclaration></Param><TOKEN>)</TOKEN>
<EnclosedExpr><TOKEN>{</TOKEN>
  <FLWORExpr><ForClause><TOKEN>for</TOKEN> <ForBinding><TOKEN>$</TOKEN><QName>n</QName> <TOKEN>in</TOKEN> <FunctionCall><QName>distinct-deep</QName><ArgumentList><TOKEN>(</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>entities</QName></VarRef><TOKEN>/</TOKEN><AxisStep><QName>ent:module</QName><PredicateList/></AxisStep></RelativePathExpr><TOKEN>)</TOKEN></ArgumentList></FunctionCall></ForBinding></ForClause>
  <ReturnClause><TOKEN>return</TOKEN> 
<DirElemConstructor><TOKEN>&lt;</TOKEN><TOKEN>text</TOKEN><DirAttributeList/><TOKEN>&gt;</TOKEN><ElementContentChar>i</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>p</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>o</ElementContentChar><ElementContentChar>d</ElementContentChar><ElementContentChar>u</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>p</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>n</QName></VarRef><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>prefix</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>/</TOKEN><FunctionCall><QName>fn:string</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>=</ElementContentChar><ElementContentChar>'</ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>n</QName></VarRef><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><TOKEN>namespace</TOKEN></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>/</TOKEN><FunctionCall><QName>fn:string</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>'</ElementContentChar><ElementContentChar>;</ElementContentChar><ElementContentChar>
</ElementContentChar><TOKEN>&lt;/</TOKEN><TOKEN>text</TOKEN><TOKEN>&gt;</TOKEN></DirElemConstructor></ReturnClause></FLWORExpr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionDecl></AnnotatedDecl><TOKEN>;</TOKEN>

<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <QName>build-describe</QName><TOKEN>(</TOKEN><Param><TOKEN>$</TOKEN><QName>entities</QName></Param><TOKEN>)</TOKEN>
<TOKEN>as</TOKEN> <QName>xs:string</QName>
<EnclosedExpr><TOKEN>{</TOKEN>
  <FLWORExpr><LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>m</QName><TOKEN>:=</TOKEN><FLWORExpr><ForClause><TOKEN>for</TOKEN> <ForBinding><TOKEN>$</TOKEN><QName>e</QName> <TOKEN>in</TOKEN>  <VarRef><TOKEN>$</TOKEN><QName>entities</QName></VarRef></ForBinding></ForClause>
          <ReturnClause><TOKEN>return</TOKEN> <FunctionCall><QName>generate</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>e</QName></VarRef><TOKEN>)</TOKEN></ArgumentList></FunctionCall></ReturnClause></FLWORExpr></LetBinding></LetClause>
  <ReturnClause><TOKEN>return</TOKEN> <DirElemConstructor><TOKEN>&lt;</TOKEN><TOKEN>text</TOKEN><DirAttributeList/><TOKEN>&gt;</TOKEN><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar>d</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>c</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>v</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>r</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>b</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar> </ElementContentChar><ElementContentChar>$</ElementContentChar><ElementContentChar>e</ElementContentChar><ElementContentChar>n</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>y</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar>l</ElementContentChar><ElementContentChar>i</ElementContentChar><ElementContentChar>s</ElementContentChar><ElementContentChar>t</ElementContentChar><ElementContentChar>:</ElementContentChar><ElementContentChar>=</ElementContentChar><ElementContentChar>m</ElementContentChar><ElementContentChar>a</ElementContentChar><ElementContentChar>p</ElementContentChar><ElementContentChar> </ElementContentChar><TOKEN>{{</TOKEN><ElementContentChar> </ElementContentChar><EnclosedExpr><TOKEN>{</TOKEN><FunctionCall><QName>fn:string-join</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>m</QName></VarRef><TOKEN>,</TOKEN><StringLiteral>","</StringLiteral><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>}</TOKEN></EnclosedExpr><ElementContentChar>
</ElementContentChar><TOKEN>}}</TOKEN><ElementContentChar>;</ElementContentChar><ElementContentChar>
</ElementContentChar><ElementContentChar>
</ElementContentChar><TOKEN>&lt;/</TOKEN><TOKEN>text</TOKEN><TOKEN>&gt;</TOKEN></DirElemConstructor></ReturnClause></FLWORExpr>        
<TOKEN>}</TOKEN></EnclosedExpr></FunctionDecl></AnnotatedDecl><TOKEN>;</TOKEN>

<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <QName>escape</QName><TOKEN>(</TOKEN><Param><TOKEN>$</TOKEN><QName>str</QName> <TypeDeclaration><TOKEN>as</TOKEN> <QName>xs:string</QName></TypeDeclaration></Param><TOKEN>)</TOKEN> 
<TOKEN>as</TOKEN> <QName>xs:string</QName>
<EnclosedExpr><TOKEN>{</TOKEN>
   <FunctionCall><QName>fn:replace</QName><ArgumentList><TOKEN>(</TOKEN>
     <FunctionCall><QName>fn:replace</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>str</QName></VarRef><TOKEN>,</TOKEN><StringLiteral>'"'</StringLiteral><TOKEN>,</TOKEN><StringLiteral>'""'</StringLiteral><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>,</TOKEN>
     <StringLiteral>"'"</StringLiteral><TOKEN>,</TOKEN><StringLiteral>"''"</StringLiteral><TOKEN>)</TOKEN></ArgumentList></FunctionCall>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionDecl></AnnotatedDecl><TOKEN>;</TOKEN>

(:-----from functx-------------------:)

 <AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <QName>distinct-deep</QName> 
  <TOKEN>(</TOKEN> <Param><TOKEN>$</TOKEN><QName>nodes</QName> <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest><TOKEN>*</TOKEN></SequenceType></TypeDeclaration></Param> <TOKEN>)</TOKEN>  <TOKEN>as</TOKEN> <SequenceType><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest><TOKEN>*</TOKEN></SequenceType> <EnclosedExpr><TOKEN>{</TOKEN>
       
    <FLWORExpr><ForClause><TOKEN>for</TOKEN> <ForBinding><TOKEN>$</TOKEN><QName>seq</QName> <TOKEN>in</TOKEN> <ParenthesizedExpr><TOKEN>(</TOKEN><RangeExpr><IntegerLiteral>1</IntegerLiteral> <TOKEN>to</TOKEN> <FunctionCall><QName>fn:count</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>nodes</QName></VarRef><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RangeExpr><TOKEN>)</TOKEN></ParenthesizedExpr></ForBinding></ForClause>
    <ReturnClause><TOKEN>return</TOKEN> <PostfixExpr><VarRef><TOKEN>$</TOKEN><QName>nodes</QName></VarRef><Predicate><TOKEN>[</TOKEN><VarRef><TOKEN>$</TOKEN><QName>seq</QName></VarRef><TOKEN>]</TOKEN></Predicate><Predicate><TOKEN>[</TOKEN><FunctionCall><QName>fn:not</QName><ArgumentList><TOKEN>(</TOKEN><FunctionCall><QName>is-node-in-sequence-deep-equal</QName><ArgumentList><TOKEN>(</TOKEN>
                          <TOKEN>.</TOKEN><TOKEN>,</TOKEN><PostfixExpr><VarRef><TOKEN>$</TOKEN><QName>nodes</QName></VarRef><Predicate><TOKEN>[</TOKEN><ComparisonExpr><FunctionCall><QName>fn:position</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall> <TOKEN>&lt;</TOKEN> <VarRef><TOKEN>$</TOKEN><QName>seq</QName></VarRef></ComparisonExpr><TOKEN>]</TOKEN></Predicate></PostfixExpr><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>]</TOKEN></Predicate></PostfixExpr></ReturnClause></FLWORExpr>
<TOKEN>}</TOKEN></EnclosedExpr></FunctionDecl></AnnotatedDecl><TOKEN>;</TOKEN>

<AnnotatedDecl><TOKEN>declare</TOKEN> <FunctionDecl><TOKEN>function</TOKEN> <QName>is-node-in-sequence-deep-equal</QName> 
  <TOKEN>(</TOKEN> <ParamList><Param><TOKEN>$</TOKEN><TOKEN>node</TOKEN> <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest><TOKEN>?</TOKEN></SequenceType></TypeDeclaration></Param> <TOKEN>,</TOKEN>
    <Param><TOKEN>$</TOKEN><QName>seq</QName> <TypeDeclaration><TOKEN>as</TOKEN> <SequenceType><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest><TOKEN>*</TOKEN></SequenceType></TypeDeclaration></Param></ParamList> <TOKEN>)</TOKEN>  <TOKEN>as</TOKEN> <QName>xs:boolean</QName> <EnclosedExpr><TOKEN>{</TOKEN>
       
   <QuantifiedExpr><TOKEN>some</TOKEN> <QuantifiedVarDecl><TOKEN>$</TOKEN><QName>nodeInSeq</QName> <TOKEN>in</TOKEN> <VarRef><TOKEN>$</TOKEN><QName>seq</QName></VarRef></QuantifiedVarDecl> <TOKEN>satisfies</TOKEN> <FunctionCall><QName>fn:deep-equal</QName><ArgumentList><TOKEN>(</TOKEN><VarRef><TOKEN>$</TOKEN><QName>nodeInSeq</QName></VarRef><TOKEN>,</TOKEN><VarRef><TOKEN>$</TOKEN><TOKEN>node</TOKEN></VarRef><TOKEN>)</TOKEN></ArgumentList></FunctionCall></QuantifiedExpr>
 <TOKEN>}</TOKEN></EnclosedExpr></FunctionDecl></AnnotatedDecl> <TOKEN>;</TOKEN></Prolog></LibraryModule> <EOF/></XQuery>