<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="Generator" content="xqdoca - https://github.com/quodatum/xqdoca">
    <title>vue-poc - xqDocA
        </title>
    <link rel="shortcut icon" type="image/x-icon" href="../../resources/xqdoc.png">
    <link rel="stylesheet" type="text/css" href="../../resources/prism.css">
    <link rel="stylesheet" type="text/css" href="../../resources/page.css">
    <link rel="stylesheet" type="text/css" href="../../resources/query.css">
    <link rel="stylesheet" type="text/css" href="../../resources/base.css">
  </head>
  <body class="home" id="top">
    <div id="main">
      <div>
        <h1>
          <span class="badge badge-info">quodatum.web.dice/v4</span>&nbsp;
			<small>library module</small>
          <div style="float:right"></div>
        </h1>
        <nav id="toc">
          <h2>
            <a href="../../index.html">vue-poc</a>
                / Module
       </h2>
          <h3>
            <a id="contents"></a>
            <span class="">quodatum.web.dice/v4</span>
          </h3>
          <ol class="toc">
            <li>
              <a href="#summary">
                <span class="secno">1 </span>
                <span class="content">Summary</span>
              </a>
            </li>
            <li>
              <a href="#imports">
                <span class="secno">2 </span>
                <span class="content">Imports</span>
              </a>
            </li>
            <li>
              <a href="#variables">
                <span class="secno">3 </span>
                <span class="content">Variables</span>
              </a>
              <ol class="toc">
                <li>
                  <a href="#$dice:default">
                    <span class="secno">3.1</span>
                    <span class="content">$dice:default</span>
                  </a>
                </li>
              </ol>
            </li>
            <li>
              <a href="#functions">
                <span class="secno">4 </span>
                <span class="content">Functions</span>
              </a>
              <ol class="toc">
                <li>
                  <a href="#dice:get">
                    <span class="secno">4.1</span>
                    <span class="content" title="">dice:get<div style="float:right"></div>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="#dice:json-flds">
                    <span class="secno">4.2</span>
                    <span class="content" title="">dice:json-flds<div style="float:right"></div>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="#dice:one">
                    <span class="secno">4.3</span>
                    <span class="content" title="">dice:one<div style="float:right"></div>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="#dice:response">
                    <span class="secno">4.4</span>
                    <span class="content" title="">dice:response<div style="float:right"></div>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="#dice:sort">
                    <span class="secno">4.5</span>
                    <span class="content" title="">dice:sort<div style="float:right"></div>
                    </span>
                  </a>
                </li>
              </ol>
            </li>
            <li>
              <a href="#namespaces">
                <span class="secno">5 </span>
                <span class="content">Namespaces</span>
              </a>
            </li>
            <li>
              <a href="#restxq">
                <span class="secno">6 </span>
                <span class="content">Restxq</span>
              </a>
              <ol class="toc">
                <xsl:for-each-group xmlns:xsl="http://www.w3.org/1999/XSL/Transform" select="qd:restxq($funs)" group-by="doc:literal/string()">
                  <xsl:sort select="current-grouping-key()"></xsl:sort>
                  <xsl:variable name="id" select="current-grouping-key()"></xsl:variable>
                  <li>
                    <a href="# TODO">
                      <span class="secno">
                        <xsl:value-of select="concat('5.',position())"></xsl:value-of>
                      </span>
                      <span class="content">
                        <xsl:value-of select="current-grouping-key()"></xsl:value-of>
                      </span>
                    </a>
                  </li>
                </xsl:for-each-group>
              </ol>
            </li>
            <li>
              <a href="#source">
                <span class="secno">7 </span>
                <span class="content">Source</span>
              </a>
            </li>
          </ol>
        </nav>
        <div class="div2">
          <h2>
            <a id="summary"></a>1 Summary</h2>
          <dl>
            <dt class="label">Summary</dt>
            <dd>dice utils - sort, filter, and serialize as json.
can read parameters from request: sort,start,limit.</dd>
            <dt>Tags</dt>
            <dd>
              <p>requires : basex 8.6 for map:merge</p>
              <p>Author: andy bunce</p>
              <p>__source : lib/dice.xqm</p>
            </dd>
          </dl>,
		<div> Imported by <a href="../../imports.html#quodatum.web.dice/v4">*</a>
          </div>,
    <ul>
            <li style="display:inline">Raw XML files: </li>
            <li style="display:inline">
              <a href="xqdoc.xml" target="xqdoc">xqdoc.xml</a>, </li>
            <li style="display:inline">
              <a href="xqparse.xml" target="xqparse">xqparse.xml</a>
            </li>
          </ul>
        </div>
        <div class="div2">
          <h2>
            <a id="imports"></a>2 Imports</h2>
          <p>
    This module is imported by
    <span class="badge badge-info">4</span> modules, it imports
    <span class="badge badge-info">0</span> modules.
    </p>
          <div style="display: flex;width:100%; justify-content: space-between;">
            <div style="width:40%;">
              <div style="text-align: right;">
                <span>
                  <a href="../../modules/F1/index.html" title="features/adminlog/logs.xqm">quodatum.test.logs</a>
                </span>
              </div>
              <div style="text-align: right;">
                <span>
                  <a href="../../modules/F4/index.html" title="features/collection/collections.xqm">quodatum:vue.api.collection</a>
                </span>
              </div>
              <div style="text-align: right;">
                <span>
                  <a href="../../modules/F21/index.html" title="features/model/rxq-entity.xqm">quodatum.model.rest</a>
                </span>
              </div>
              <div style="text-align: right;">
                <span>
                  <a href="../../modules/F24/index.html" title="features/search/search.xqm">quodatum:vue.search</a>
                </span>
              </div>
            </div>
            <div style="display: flex; flex-direction: column; justify-content: center;">
              <div>
                <div>imports</div>→</div>
              <div class="badge badge-info">this</div>
              <div>
                <div>imports</div>→</div>
            </div>
            <div style="width:40%;">(None)</div>
          </div>
        </div>
        <div class="div2">
          <h2>
            <a id="variables"></a>3 Variables
			</h2>
          <div class="div3">
            <h3>
              <a id="$dice:default"></a>3.1&nbsp;$dice:default</h3>
            <dl>
              <dt class="label">Summary</dt>
              <dd></dd>
              <dt class="label">Type</dt>
              <dd>map(*)</dd>
            </dl>
          </div>
        </div>
        <div class="div2">
          <h2>
            <a id="functions"></a>4 Functions</h2>
          <div class="div3">
            <h3>
              <a id="dice:get"></a>
              <a id="{quodatum.web.dice/v4}get#2"></a>4.1&nbsp;dice:get<div style="float:right">
                <a href="#dice:get">#</a>
              </div>
            </h3>
            <p>Arities: <span style="margin-left:1em">
                <a href="#{quodatum.web.dice/v4}get#2">dice:get#2</a>
              </span>
            </p>
            <dt class="label">Summary</dt>
            <dd>get data for object with key =name</dd>
            <dt class="label">Signature</dt>
            <dd>
              <div class="proto">
                <code class="function">dice:get</code>
		  ( 
			<code class="arg">$entity</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">map(*)</code>, <code class="arg">$name</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">xs:string</code>
	 )
			<code class="as">&nbsp;as&nbsp;</code>
                <code class="return-type">
                  <xqdoc:type xmlns:xqdoc="http://www.xqdoc.org/1.0">element()</xqdoc:type>
                </code>
              </div>
            </dd>
            <dt class="label">Parameters</dt>
            <dd>
              <ul>
                <li>entity<code class="as">&nbsp;as&nbsp;</code>
                  <code class="return-type">map(*)</code>
                </li>
                <li>name<code class="as">&nbsp;as&nbsp;</code>
                  <code class="return-type">xs:string</code>
                </li>
              </ul>
            </dd>
            <dt class="label">Return</dt>
            <dd>
              <ul>
                <li>
                  <code class="return-type">element()</code>
                </li>
              </ul>
            </dd>
            <details>
              <summary>Source</summary>
              <pre>
                <code class="language-xquery">function dice:get($entity as map(*),$name as xs:string)
as element(*){
    let $results:=$entity("data")()
    return $results[$name=$entity?access?name(.)]
}</code>
              </pre>
            </details>
            <details>
              <summary>Invoked by 0 functions from 0 modules</summary>
              <ul></ul>
            </details>
          </div>
          <div class="div3">
            <h3>
              <a id="dice:json-flds"></a>
              <a id="{quodatum.web.dice/v4}json-flds#2"></a>
              <a id="{quodatum.web.dice/v4}json-flds#3"></a>4.2&nbsp;dice:json-flds<div style="float:right">
                <a href="#dice:json-flds">#</a>
              </div>
            </h3>
            <p>Arities: <span style="margin-left:1em">
                <a href="#{quodatum.web.dice/v4}json-flds#2">dice:json-flds#2</a>
              </span>
              <span style="margin-left:1em">
                <a href="#{quodatum.web.dice/v4}json-flds#3">dice:json-flds#3</a>
              </span>
            </p>
            <dt class="label">Summary</dt>
            <dd>generate item xml for all fields in map</dd>
            <dt class="label">Signature</dt>
            <dd>
              <div class="proto">
                <code class="function">dice:json-flds</code>
		  ( 
			<code class="arg">$item</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">item()*</code>, <code class="arg">$fldmap</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">item()*</code>
	 )
			<code class="as">&nbsp;as&nbsp;</code>
                <code class="return-type">
                  <xqdoc:type xmlns:xqdoc="http://www.xqdoc.org/1.0">element(_)</xqdoc:type>
                </code>
              </div>
              <div class="proto">
                <code class="function">dice:json-flds</code>
		  ( 
			<code class="arg">$item</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">element()</code>, <code class="arg">$fldmap</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">map(*)</code>, <code class="arg">$keys</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">xs:string*</code>
	 )
			<code class="as">&nbsp;as&nbsp;</code>
                <code class="return-type">
                  <xqdoc:type xmlns:xqdoc="http://www.xqdoc.org/1.0">element(_)</xqdoc:type>
                </code>
              </div>
            </dd>
            <dt class="label">Parameters</dt>
            <dd>
              <ul>
                <li>item<code class="as">&nbsp;as&nbsp;</code>
                  <code class="return-type">item()*</code>
                </li>
                <li>fldmap<code class="as">&nbsp;as&nbsp;</code>
                  <code class="return-type">item()*</code>
                </li>
              </ul>
            </dd>
            <dt class="label">Return</dt>
            <dd>
              <ul>
                <li>
                  <code class="return-type">element(_)</code>
                </li>
              </ul>
            </dd>
            <details>
              <summary>Source</summary>
              <pre>
                <code class="language-xquery">function dice:json-flds($item,$fldmap)
as element(_){
  dice:json-flds($item,$fldmap,map:keys($fldmap)) 
}</code>
              </pre>
              <pre>
                <code class="language-xquery">function dice:json-flds($item as element(),
                           $fldmap as map(*),
						   $keys as xs:string*)
as element(_){ 
    &lt;_&gt; 
    {for $key in $keys 
	return 
    try{
       $fldmap($key)($item)
    }catch * {
       element {$key}{$err:description }
    } }
	&lt;/_&gt;
}</code>
              </pre>
            </details>
            <details>
              <summary>Invokes 2 functions from 2 modules </summary>
              <ul>
                <li>
                  <span class="badge badge-warning" title="Externally defined">{http://www.w3.org/2005/xpath-functions/map}keys#1</span>
                </li>
                <li>
                  <span>
                    <a href="../../modules/F58/index.html#{quodatum.web.dice/v4}json-flds#3" title="lib/dice.xqm">dice:json-flds#3</a>
                  </span>
                </li>
              </ul>
            </details>
            <details>
              <summary>Invoked by 2 functions from 2 modules</summary>
              <ul>
                <li>
                  <span>
                    <a href="../../modules/F21/index.html#{quodatum.model.rest}model" title="features/model/rxq-entity.xqm">model-rest:model</a>
                  </span>
                </li>
                <li>
                  <span>
                    <a href="../../modules/F58/index.html#{quodatum.web.dice/v4}json-flds" title="lib/dice.xqm">dice:json-flds</a>
                  </span>
                </li>
              </ul>
            </details>
          </div>
          <div class="div3">
            <h3>
              <a id="dice:one"></a>
              <a id="{quodatum.web.dice/v4}one#2"></a>
              <a id="{quodatum.web.dice/v4}one#3"></a>4.3&nbsp;dice:one<div style="float:right">
                <a href="#dice:one">#</a>
              </div>
            </h3>
            <p>Arities: <span style="margin-left:1em">
                <a href="#{quodatum.web.dice/v4}one#2">dice:one#2</a>
              </span>
              <span style="margin-left:1em">
                <a href="#{quodatum.web.dice/v4}one#3">dice:one#3</a>
              </span>
            </p>
            <dt class="label">Summary</dt>
            <dd></dd>
            <dt class="label">Signature</dt>
            <dd>
              <div class="proto">
                <code class="function">dice:one</code>
		  ( 
			<code class="arg">$item</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">item()*</code>, <code class="arg">$entity</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">map(*)</code>
	 )
			<code class="as">&nbsp;as&nbsp;</code>
                <code class="return-type">
                  <xqdoc:type xmlns:xqdoc="http://www.xqdoc.org/1.0" occurrence="*">item()</xqdoc:type>*</code>
              </div>
              <div class="proto">
                <code class="function">dice:one</code>
		  ( 
			<code class="arg">$item</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">item()*</code>, <code class="arg">$entity</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">map(*)</code>, <code class="arg">$opts</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">map(*)</code>
	 )
			<code class="as">&nbsp;as&nbsp;</code>
                <code class="return-type">
                  <xqdoc:type xmlns:xqdoc="http://www.xqdoc.org/1.0">element(json)</xqdoc:type>
                </code>
              </div>
            </dd>
            <dt class="label">Parameters</dt>
            <dd>
              <ul>
                <li>item<code class="as">&nbsp;as&nbsp;</code>
                  <code class="return-type">item()*</code>
                </li>
                <li>entity<code class="as">&nbsp;as&nbsp;</code>
                  <code class="return-type">map(*)</code>
                </li>
              </ul>
            </dd>
            <dt class="label">Return</dt>
            <dd>
              <ul>
                <li>
                  <code class="return-type">item()*</code>
                </li>
              </ul>
            </dd>
            <details>
              <summary>Source</summary>
              <pre>
                <code class="language-xquery">function dice:one($item,$entity as map(*))
{
  dice:one($item,$entity,map{})
}</code>
              </pre>
              <pre>
                <code class="language-xquery">function dice:one($item,$entity as map(*),$opts as map(*))
as element(json)
{
  let $jsonf:= map:get($entity,"json")
  let $fields:=if ($opts?fields) then fn:tokenize($opts?fields) else map:keys($jsonf)=&gt;fn:trace("FF")
  
  return  &lt;json objects="json " &gt;
  {$fields!$jsonf(.)($item)}
  &lt;/json&gt; 
}</code>
              </pre>
            </details>
            <details>
              <summary>Invokes 5 functions from 3 modules </summary>
              <ul>
                <li>
                  <span class="badge badge-warning" title="Externally defined">{http://www.w3.org/2005/xpath-functions/map}get#2</span>
                </li>
                <li>
                  <span class="badge badge-warning" title="Externally defined">{http://www.w3.org/2005/xpath-functions/map}keys#1</span>
                </li>
                <li>
                  <span class="badge badge-warning" title="Externally defined">{http://www.w3.org/2005/xpath-functions}tokenize#1</span>
                </li>
                <li>
                  <span class="badge badge-warning" title="Externally defined">{http://www.w3.org/2005/xpath-functions}trace#4</span>
                </li>
                <li>
                  <span>
                    <a href="../../modules/F58/index.html#{quodatum.web.dice/v4}one#3" title="lib/dice.xqm">dice:one#3</a>
                  </span>
                </li>
              </ul>
            </details>
            <details>
              <summary>Invoked by 1 functions from 1 modules</summary>
              <ul>
                <li>
                  <span>
                    <a href="../../modules/F58/index.html#{quodatum.web.dice/v4}one" title="lib/dice.xqm">dice:one</a>
                  </span>
                </li>
              </ul>
            </details>
          </div>
          <div class="div3">
            <h3>
              <a id="dice:response"></a>
              <a id="{quodatum.web.dice/v4}response#2"></a>
              <a id="{quodatum.web.dice/v4}response#3"></a>4.4&nbsp;dice:response<div style="float:right">
                <a href="#dice:response">#</a>
              </div>
            </h3>
            <p>Arities: <span style="margin-left:1em">
                <a href="#{quodatum.web.dice/v4}response#2">dice:response#2</a>
              </span>
              <span style="margin-left:1em">
                <a href="#{quodatum.web.dice/v4}response#3">dice:response#3</a>
              </span>
            </p>
            <dt class="label">Summary</dt>
            <dd>sort, slice, return json using request parameters</dd>
            <dt class="label">Signature</dt>
            <dd>
              <div class="proto">
                <code class="function">dice:response</code>
		  ( 
			<code class="arg">$items</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">item()*</code>, <code class="arg">$entity</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">map(*)</code>
	 )
			<code class="as">&nbsp;as&nbsp;</code>
                <code class="return-type">
                  <xqdoc:type xmlns:xqdoc="http://www.xqdoc.org/1.0" occurrence="*">item()</xqdoc:type>*</code>
              </div>
              <div class="proto">
                <code class="function">dice:response</code>
		  ( 
			<code class="arg">$items</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">item()*</code>, <code class="arg">$entity</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">map(*)</code>, <code class="arg">$opts</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">map(*)</code>
	 )
			<code class="as">&nbsp;as&nbsp;</code>
                <code class="return-type">
                  <xqdoc:type xmlns:xqdoc="http://www.xqdoc.org/1.0">element(json)</xqdoc:type>
                </code>
              </div>
            </dd>
            <dt class="label">Parameters</dt>
            <dd>
              <ul>
                <li>items<code class="as">&nbsp;as&nbsp;</code>
                  <code class="return-type">item()*</code>
                </li>
                <li>entity<code class="as">&nbsp;as&nbsp;</code>
                  <code class="return-type">map(*)</code>
                </li>
              </ul>
            </dd>
            <dt class="label">Return</dt>
            <dd>
              <ul>
                <li>
                  <code class="return-type">item()*</code>
                </li>
              </ul>
            </dd>
            <details>
              <summary>Source</summary>
              <pre>
                <code class="language-xquery">function dice:response($items,$entity as map(*))
{
    dice:response($items,$entity,map{})
}</code>
              </pre>
              <pre>
                <code class="language-xquery">function dice:response($items,
                          $entity as map(*),
                          $opts as map(*))
 as element(json)
 {
  let $total:=fn:count($items)
  let $opts:=map:merge(($opts,$dice:default))
  let $items:= dice:sort($items,$entity?access,$opts?sort)
  let $jsonf:= $entity?json
  let $fields:=if ($opts?fields) then fn:tokenize($opts?fields) else map:keys($jsonf)
  let $slice:= fn:subsequence($items,$opts?start,$opts?limit)
  return 
  &lt;json objects="json _" &gt;
    &lt;total type="number"&gt;{$total}&lt;/total&gt;
    &lt;range&gt;{$opts?start}-{$opts?start+fn:count($slice)-1}/{$total}&lt;/range&gt;
    &lt;entity&gt;{$entity?name}&lt;/entity&gt;
    &lt;items type="array"&gt;
        {for $item in $slice
        return &lt;_ &gt;{$fields!$jsonf(.)($item)}&lt;/_&gt;}
    &lt;/items&gt;
  &lt;/json&gt; 
}</code>
              </pre>
            </details>
            <details>
              <summary>Invokes 7 functions from 3 modules </summary>
              <ul>
                <li>
                  <span class="badge badge-warning" title="Externally defined">{http://www.w3.org/2005/xpath-functions/map}keys#1</span>
                </li>
                <li>
                  <span class="badge badge-warning" title="Externally defined">{http://www.w3.org/2005/xpath-functions/map}merge#1</span>
                </li>
                <li>
                  <span class="badge badge-warning" title="Externally defined">{http://www.w3.org/2005/xpath-functions}count#1</span>
                </li>
                <li>
                  <span class="badge badge-warning" title="Externally defined">{http://www.w3.org/2005/xpath-functions}subsequence#3</span>
                </li>
                <li>
                  <span class="badge badge-warning" title="Externally defined">{http://www.w3.org/2005/xpath-functions}tokenize#1</span>
                </li>
                <li>
                  <span>
                    <a href="../../modules/F58/index.html#{quodatum.web.dice/v4}response#3" title="lib/dice.xqm">dice:response#3</a>
                  </span>
                </li>
                <li>
                  <span>
                    <a href="../../modules/F58/index.html#{quodatum.web.dice/v4}sort#3" title="lib/dice.xqm">dice:sort#3</a>
                  </span>
                </li>
              </ul>
            </details>
            <details>
              <summary>Invoked by 8 functions from 5 modules</summary>
              <ul>
                <li>
                  <span>
                    <a href="../../modules/F1/index.html#{quodatum.test.logs}list" title="features/adminlog/logs.xqm">j:list</a>
                  </span>
                </li>
                <li>
                  <span>
                    <a href="../../modules/F4/index.html#{quodatum:vue.api.collection}history" title="features/collection/collections.xqm">vue-api:history</a>
                  </span>
                </li>
                <li>
                  <span>
                    <a href="../../modules/F4/index.html#{quodatum:vue.api.collection}xqdoc" title="features/collection/collections.xqm">vue-api:xqdoc</a>
                  </span>
                </li>
                <li>
                  <span>
                    <a href="../../modules/F21/index.html#{quodatum.model.rest}model-list" title="features/model/rxq-entity.xqm">model-rest:model-list</a>
                  </span>
                </li>
                <li>
                  <span>
                    <a href="../../modules/F21/index.html#{quodatum.model.rest}data" title="features/model/rxq-entity.xqm">model-rest:data</a>
                  </span>
                </li>
                <li>
                  <span>
                    <a href="../../modules/F21/index.html#{quodatum.model.rest}field-list" title="features/model/rxq-entity.xqm">model-rest:field-list</a>
                  </span>
                </li>
                <li>
                  <span>
                    <a href="../../modules/F24/index.html#{quodatum:vue.search}search" title="features/search/search.xqm">vue-search:search</a>
                  </span>
                </li>
                <li>
                  <span>
                    <a href="../../modules/F58/index.html#{quodatum.web.dice/v4}response" title="lib/dice.xqm">dice:response</a>
                  </span>
                </li>
              </ul>
            </details>
          </div>
          <div class="div3">
            <h3>
              <a id="dice:sort"></a>
              <a id="{quodatum.web.dice/v4}sort#3"></a>4.5&nbsp;dice:sort<div style="float:right">
                <a href="#dice:sort">#</a>
              </div>
            </h3>
            <p>Arities: <span style="margin-left:1em">
                <a href="#{quodatum.web.dice/v4}sort#3">dice:sort#3</a>
              </span>
            </p>
            <dt class="label">Summary</dt>
            <dd>sort items</dd>
            <dt class="label">Signature</dt>
            <dd>
              <div class="proto">
                <code class="function">dice:sort</code>
		  ( 
			<code class="arg">$items</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">item()*</code>, <code class="arg">$fmap</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">map(*)</code>, <code class="arg">$sort</code>
                <code class="as">&nbsp;as&nbsp;</code>
                <code class="type">xs:string?</code>
	 )
			<code class="as">&nbsp;as&nbsp;</code>
                <code class="return-type">
                  <xqdoc:type xmlns:xqdoc="http://www.xqdoc.org/1.0" occurrence="*">item()</xqdoc:type>*</code>
              </div>
            </dd>
            <dt class="label">Parameters</dt>
            <dd>
              <ul>
                <li>items<code class="as">&nbsp;as&nbsp;</code>
                  <code class="return-type">item()*</code>
                </li>
                <li>fmap<code class="as">&nbsp;as&nbsp;</code>
                  <code class="return-type">map(*)</code> as map(*) field</li>
                <li>sort<code class="as">&nbsp;as&nbsp;</code>
                  <code class="return-type">xs:string?</code> field name to sort on. Optional leading +/-</li>
              </ul>
            </dd>
            <dt class="label">Return</dt>
            <dd>
              <ul>
                <li>
                  <code class="return-type">item()*</code>
                </li>
              </ul>
            </dd>
            <details>
              <summary>Source</summary>
              <pre>
                <code class="language-xquery">function dice:sort($items as item()*
                     ,$fmap as map(*)
                     ,$sort as xs:string?)
as item()*{
  let $sort:=fn:normalize-space($sort)
  let $ascending:=fn:not(fn:starts-with($sort,"-"))
  let $fld:=fn:substring($sort,if(fn:substring($sort,1,1)=("+","-")) then 2 else 1)
  return if(fn:not(map:contains($fmap, $fld))) then
            $items
          else if ($ascending) then
            for $i in $items
           (: let $i:=fn:trace($i,"feld " || $fld ) :)
            order by $fmap($fld)($i) ascending collation "http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"
            return $i
          else
            for $i in $items 
            order by  $fmap($fld)($i) descending collation "http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"
            return $i
}</code>
              </pre>
            </details>
            <details>
              <summary>Invokes 6 functions from 2 modules </summary>
              <ul>
                <li>
                  <span class="badge badge-warning" title="Externally defined">{http://www.w3.org/2005/xpath-functions/map}contains#2</span>
                </li>
                <li>
                  <span class="badge badge-warning" title="Externally defined">{http://www.w3.org/2005/xpath-functions}normalize-space#1</span>
                </li>
                <li>
                  <span class="badge badge-warning" title="Externally defined">{http://www.w3.org/2005/xpath-functions}not#1</span>
                </li>
                <li>
                  <span class="badge badge-warning" title="Externally defined">{http://www.w3.org/2005/xpath-functions}starts-with#2</span>
                </li>
                <li>
                  <span class="badge badge-warning" title="Externally defined">{http://www.w3.org/2005/xpath-functions}substring#2</span>
                </li>
                <li>
                  <span class="badge badge-warning" title="Externally defined">{http://www.w3.org/2005/xpath-functions}substring#3</span>
                </li>
              </ul>
            </details>
            <details>
              <summary>Invoked by 1 functions from 1 modules</summary>
              <ul>
                <li>
                  <span>
                    <a href="../../modules/F58/index.html#{quodatum.web.dice/v4}response" title="lib/dice.xqm">dice:response</a>
                  </span>
                </li>
              </ul>
            </details>
          </div>
        </div>
        <div class="div2">
          <h2>
            <a id="namespaces"></a>5 Namespaces</h2>
          <p>The following namespaces are defined:</p>
          <table class="data" style="float:none">
            <thead>
              <tr>
                <th>Prefix</th>
                <th>Uri</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>dice</td>
                <td>
                  <span>
                    <a href="../../modules/F58/index.html" title="lib/dice.xqm">quodatum.web.dice/v4</a>
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="div2">
          <h2>
            <a id="restxq"></a>6 RestXQ</h2>
          <p>None</p>
        </div>
        <div class="div2">
          <h2>
            <a id="source"></a>7 Source Code</h2>
          <pre>
            <code class="language-xquery">xquery version "3.1";
(:~
: dice utils - sort, filter, and serialize as json.
: can read parameters from request: sort,start,limit.
: @requires basex 8.6 for map:merge
: @author andy bunce
: @since mar 2013
:)

module namespace dice = 'quodatum.web.dice/v4';

declare variable $dice:default:=map{
    "start" : 1, (: start index :)
    "limit" : 30, (: max items :)
    "sort" : ""
};


(:~ 
 : sort items
 : @param sort  field name to sort on. Optional leading +/-
 : @param $fmap as map(*) field
 : @return sorted items 
 :)
declare function dice:sort($items as item()*
                     ,$fmap as map(*)
                     ,$sort as xs:string?)
as item()*{
  let $sort:=fn:normalize-space($sort)
  let $ascending:=fn:not(fn:starts-with($sort,"-"))
  let $fld:=fn:substring($sort,if(fn:substring($sort,1,1)=("+","-")) then 2 else 1)
  return if(fn:not(map:contains($fmap, $fld))) then
            $items
          else if ($ascending) then
            for $i in $items
           (: let $i:=fn:trace($i,"feld " || $fld ) :)
            order by $fmap($fld)($i) ascending collation "http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"
            return $i
          else
            for $i in $items 
            order by  $fmap($fld)($i) descending collation "http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"
            return $i
};

(:~ generate item xml for all fields in map :)
declare function dice:json-flds($item,$fldmap)
as element(_){
  dice:json-flds($item,$fldmap,map:keys($fldmap)) 
};

(:~ generate item xml for some fields in map :)
declare function dice:json-flds($item as element(),
                           $fldmap as map(*),
						   $keys as xs:string*)
as element(_){ 
    &lt;_&gt; 
    {for $key in $keys 
	return 
    try{
       $fldmap($key)($item)
    }catch * {
       element {$key}{$err:description }
    } }
	&lt;/_&gt;
};


(:~ 
 : sort, slice, return json using request parameters
 : @param $items sequence of source items
 : @param $opts sort and slice values
 :)
declare function dice:response($items,
                          $entity as map(*),
                          $opts as map(*))
 as element(json)
 {
  let $total:=fn:count($items)
  let $opts:=map:merge(($opts,$dice:default))
  let $items:= dice:sort($items,$entity?access,$opts?sort)
  let $jsonf:= $entity?json
  let $fields:=if ($opts?fields) then fn:tokenize($opts?fields) else map:keys($jsonf)
  let $slice:= fn:subsequence($items,$opts?start,$opts?limit)
  return 
  &lt;json objects="json _" &gt;
    &lt;total type="number"&gt;{$total}&lt;/total&gt;
    &lt;range&gt;{$opts?start}-{$opts?start+fn:count($slice)-1}/{$total}&lt;/range&gt;
    &lt;entity&gt;{$entity?name}&lt;/entity&gt;
    &lt;items type="array"&gt;
        {for $item in $slice
        return &lt;_ &gt;{$fields!$jsonf(.)($item)}&lt;/_&gt;}
    &lt;/items&gt;
  &lt;/json&gt; 
};

(:~ 
 : sort, slice, return json
 :)
declare function dice:response($items,$entity as map(*))
{
    dice:response($items,$entity,map{})
};

(:~ 
 : get data for object with key =name
 :)
declare function dice:get($entity as map(*),$name as xs:string)
as element(*){
    let $results:=$entity("data")()
    return $results[$name=$entity?access?name(.)]
};


(:~ 
 : @return  json for item
 :)
declare function dice:one($item,$entity as map(*))
{
  dice:one($item,$entity,map{})
};

(:~ 
 : @return  json for item
 :)
declare function dice:one($item,$entity as map(*),$opts as map(*))
as element(json)
{
  let $jsonf:= map:get($entity,"json")
  let $fields:=if ($opts?fields) then fn:tokenize($opts?fields) else map:keys($jsonf)=&gt;fn:trace("FF")
  
  return  &lt;json objects="json " &gt;
  {$fields!$jsonf(.)($item)}
  &lt;/json&gt; 
};
</code>
          </pre>
        </div>
      </div>
    </div>
    <div class="footer">
      <p style="text-align:right">Generated by 
            <a href="https://github.com/Quodatum/xqdoca" target="_blank">xqDocA</a> 
            at <span title="2019-06-01T11:02:48.049+01:00">11.02am on Saturday, June 1st 2019</span>
      </p>
    </div>
    <script src="../../resources/prism.js" type="text/javascript"></script>
  </body>
</html>