<xqdoc:xqdoc xmlns:xqdoc="http://www.xqdoc.org/1.0"><xqdoc:control><xqdoc:date>2019-06-07T17:23:03.708+01:00</xqdoc:date><xqdoc:version>1.1</xqdoc:version></xqdoc:control><xqdoc:module type="main"><xqdoc:uri>createwadl.xq</xqdoc:uri><xqdoc:comment><xqdoc:description>wadl</xqdoc:description></xqdoc:comment><xqdoc:body>(:~ wadl:)
declare namespace xqdoc="http://www.xqdoc.org/1.0";
declare namespace wadl="http://wadl.dev.java.net/2009/02";
declare variable $src:="C:\tmp\xqdoc\src\graphxq\graphxq.xqm";

declare function local:get($fun as element(xqdoc:function)*,$path as xs:string)
as element(wadl:resource)
{
 &lt;wadl:resource path="{$path}"&gt;
&lt;wadl:method name="GET"&gt;
        &lt;wadl:doc xmlns="http://www.w3.org/1999/xhtml"&gt;about page for app&lt;/wadl:doc&gt;
        &lt;wadl:request/&gt;
        &lt;wadl:response&gt;
          &lt;wadl:representation mediaType="image/svg+xml"/&gt;
        &lt;/wadl:response&gt;

      &lt;/wadl:method&gt;
&lt;/wadl:resource&gt; 
};
let $xq:=doc($src)
let $prefix:=$xq//xqdoc:namespace[@uri="http://exquery.org/ns/restxq"]/@prefix/string()
let $paths:=$xq//xqdoc:functions/xqdoc:function/xqdoc:annotations/xqdoc:annotation[@name=$prefix || ":path"]/xqdoc:literal
let $p2:=$paths=&gt;distinct-values()=&gt;sort()
return &lt;wadl:application&gt;
&lt;wadl:resources base="http://localhost:8984/doc/app//graphxq/view/wadl"&gt;
{for  $p in  $p2 return  local:get((),$p)}
&lt;/wadl:resources&gt;
&lt;/wadl:application&gt;</xqdoc:body></xqdoc:module><xqdoc:imports/><xqdoc:namespaces><xqdoc:namespace prefix="xqdoc" uri="http://www.xqdoc.org/1.0"/><xqdoc:namespace prefix="wadl" uri="http://wadl.dev.java.net/2009/02"/><xqdoc:namespace prefix="local" uri="http://www.w3.org/2005/xquery-local-functions"/><xqdoc:namespace prefix="local" uri="http://www.w3.org/2005/xquery-local-functions"/></xqdoc:namespaces><xqdoc:variables><xqdoc:variable><xqdoc:name>src</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:variable></xqdoc:variables><xqdoc:functions><xqdoc:function arity="2"><xqdoc:name>local:get</xqdoc:name><xqdoc:signature>declare function local:get($fun as element(xqdoc:function)*, $path as xs:string) as element(wadl:resource)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>fun</xqdoc:name><xqdoc:type occurrence="*">element(xqdoc:function)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>path</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element(wadl:resource)</xqdoc:type></xqdoc:return><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>path</xqdoc:name></xqdoc:ref-variable><xqdoc:body>function local:get($fun as element(xqdoc:function)*,$path as xs:string)
as element(wadl:resource)
{
 &lt;wadl:resource path="{$path}"&gt;
&lt;wadl:method name="GET"&gt;
        &lt;wadl:doc xmlns="http://www.w3.org/1999/xhtml"&gt;about page for app&lt;/wadl:doc&gt;
        &lt;wadl:request/&gt;
        &lt;wadl:response&gt;
          &lt;wadl:representation mediaType="image/svg+xml"/&gt;
        &lt;/wadl:response&gt;

      &lt;/wadl:method&gt;
&lt;/wadl:resource&gt; 
}</xqdoc:body></xqdoc:function><xqdoc:function arity="0"><xqdoc:comment><xqdoc:description>pseudo main function</xqdoc:description></xqdoc:comment><xqdoc:name>local:xqDoc-main</xqdoc:name><xqdoc:signature>local:xqDoc-main()</xqdoc:signature><xqdoc:body>let $xq:=doc($src)
let $prefix:=$xq//xqdoc:namespace[@uri="http://exquery.org/ns/restxq"]/@prefix/string()
let $paths:=$xq//xqdoc:functions/xqdoc:function/xqdoc:annotations/xqdoc:annotation[@name=$prefix || ":path"]/xqdoc:literal
let $p2:=$paths=&gt;distinct-values()=&gt;sort()
return &lt;wadl:application&gt;
&lt;wadl:resources base="http://localhost:8984/doc/app//graphxq/view/wadl"&gt;
{for  $p in  $p2 return  local:get((),$p)}
&lt;/wadl:resources&gt;
&lt;/wadl:application&gt;</xqdoc:body><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>doc</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>string</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xquery-local-functions</xqdoc:uri><xqdoc:name>get</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="3"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>distinct-values</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="3"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>sort</xqdoc:name></xqdoc:invoked><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>src</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>xq</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>xq</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>prefix</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>paths</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>p2</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>p</xqdoc:name></xqdoc:ref-variable><xqdoc:body>let $xq:=doc($src)
let $prefix:=$xq//xqdoc:namespace[@uri="http://exquery.org/ns/restxq"]/@prefix/string()
let $paths:=$xq//xqdoc:functions/xqdoc:function/xqdoc:annotations/xqdoc:annotation[@name=$prefix || ":path"]/xqdoc:literal
let $p2:=$paths=&gt;distinct-values()=&gt;sort()
return &lt;wadl:application&gt;
&lt;wadl:resources base="http://localhost:8984/doc/app//graphxq/view/wadl"&gt;
{for  $p in  $p2 return  local:get((),$p)}
&lt;/wadl:resources&gt;
&lt;/wadl:application&gt;</xqdoc:body></xqdoc:function></xqdoc:functions></xqdoc:xqdoc>