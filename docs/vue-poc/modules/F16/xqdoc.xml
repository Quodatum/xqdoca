<xqdoc:xqdoc xmlns:xqdoc="http://www.xqdoc.org/1.0"><xqdoc:control><xqdoc:date>2019-05-22T11:22:52.354+01:00</xqdoc:date><xqdoc:version>1.1</xqdoc:version></xqdoc:control><xqdoc:module type="main"><xqdoc:uri>save-thumb-format.xq</xqdoc:uri><xqdoc:comment><xqdoc:description>save in multiple formats</xqdoc:description></xqdoc:comment><xqdoc:body>(:~  save in multiple formats  :)

import module namespace t="expkg-zone58:image.thumbnailator";

declare  namespace cfg = "quodatum:media.image.configure";

declare variable $cfg:IMAGEDIR:="P:/pictures/";

let $types:=("gif","jpg","png")
for $type in $types
let $task:=&lt;thumbnail&gt;
              &lt;size width="100" height="100"/&gt;
              &lt;output format="{ $type }"/&gt; 
            &lt;/thumbnail&gt;
let $thumb:= file:resolve-path("Pictures/2002/05 may/2005/DSCF1313.JPG", $cfg:IMAGEDIR)
=&gt;fetch:binary()
=&gt;t:task($task)
return file:write-binary(``[c:\tmp\thumb.`{$type}`]``,$thumb)</xqdoc:body></xqdoc:module><xqdoc:namespaces><xqdoc:namespace prefix="t" uri="expkg-zone58:image.thumbnailator"/><xqdoc:namespace prefix="cfg" uri="quodatum:media.image.configure"/></xqdoc:namespaces><xqdoc:imports><xqdoc:import type="library"><xqdoc:uri>expkg-zone58:image.thumbnailator</xqdoc:uri></xqdoc:import></xqdoc:imports><xqdoc:variables><xqdoc:variable><xqdoc:name>cfg:IMAGEDIR</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:variable></xqdoc:variables><xqdoc:functions><xqdoc:function arity="0"><xqdoc:comment><xqdoc:description>pseudo main function</xqdoc:description></xqdoc:comment><xqdoc:name>local:xqDoc-main</xqdoc:name><xqdoc:signature>local:xqDoc-main()</xqdoc:signature><xqdoc:body>let $types:=("gif","jpg","png")
for $type in $types
let $task:=&lt;thumbnail&gt;
              &lt;size width="100" height="100"/&gt;
              &lt;output format="{ $type }"/&gt; 
            &lt;/thumbnail&gt;
let $thumb:= file:resolve-path("Pictures/2002/05 may/2005/DSCF1313.JPG", $cfg:IMAGEDIR)
=&gt;fetch:binary()
=&gt;t:task($task)
return file:write-binary(``[c:\tmp\thumb.`{$type}`]``,$thumb)</xqdoc:body><xqdoc:body>let $types:=("gif","jpg","png")
for $type in $types
let $task:=&lt;thumbnail&gt;
              &lt;size width="100" height="100"/&gt;
              &lt;output format="{ $type }"/&gt; 
            &lt;/thumbnail&gt;
let $thumb:= file:resolve-path("Pictures/2002/05 may/2005/DSCF1313.JPG", $cfg:IMAGEDIR)
=&gt;fetch:binary()
=&gt;t:task($task)
return file:write-binary(``[c:\tmp\thumb.`{$type}`]``,$thumb)</xqdoc:body><xqdoc:invoked arity="2"><xqdoc:uri>http://expath.org/ns/file</xqdoc:uri><xqdoc:name>resolve-path</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://expath.org/ns/file</xqdoc:uri><xqdoc:name>write-binary</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="3"><xqdoc:uri>http://basex.org/modules/fetch</xqdoc:uri><xqdoc:name>binary</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="3"><xqdoc:uri>expkg-zone58:image.thumbnailator</xqdoc:uri><xqdoc:name>task</xqdoc:name></xqdoc:invoked><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>types</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>type</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>quodatum:media.image.configure</xqdoc:uri><xqdoc:name>IMAGEDIR</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>task</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>type</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>thumb</xqdoc:name></xqdoc:ref-variable></xqdoc:function></xqdoc:functions></xqdoc:xqdoc>