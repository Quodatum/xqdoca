<xqdoc:xqdoc xmlns:xqdoc="http://www.xqdoc.org/1.0"><xqdoc:control><xqdoc:date>2019-06-01T11:02:48.049+01:00</xqdoc:date><xqdoc:version>1.1</xqdoc:version></xqdoc:control><xqdoc:module type="main"><xqdoc:uri>pipe.xq</xqdoc:uri><xqdoc:body>import module namespace qipe='http://quodatum.com/ns/pipeline' at "../../lib/pipeline.xqm" ;

declare namespace docinfo="http://www.lexis-nexis.com/glp/docinfo";
declare variable $base:="C:\Users\andy\Dropbox\job\lexisnexis.2\data\";
declare variable $src:="C:\Users\andy\Desktop\basex.versions\data\08s3\raw\";
declare function local:resolve($path,$base){
  file:resolve-path($path,$base)
};
let $ip:=file:list($src,false(), "*.xml")
let $ip:=subsequence($ip,1,10)!doc(concat($src,.))
let $d:=
&lt;root xmlns="http://quodatum.com/ns/pipeline"&gt;
 &lt;xslt href="{ local:resolve('08S3-to-rosetta-legdoc.xsl',$base) }"/&gt;
 &lt;validate href="{ local:resolve('legdoc-norm.dtd',$base) }" type="dtd" failOnError="true"/&gt;
 &lt;store base="c:\tmp\" fileExpression="'a' || $position || '.xml'" dated="true"/&gt;
&lt;/root&gt;

 return qipe:run($d,$ip)


</xqdoc:body></xqdoc:module><xqdoc:imports><xqdoc:import type="library"><xqdoc:uri>http://quodatum.com/ns/pipeline</xqdoc:uri></xqdoc:import></xqdoc:imports><xqdoc:namespaces><xqdoc:namespace prefix="qipe" uri="http://quodatum.com/ns/pipeline"/><xqdoc:namespace prefix="docinfo" uri="http://www.lexis-nexis.com/glp/docinfo"/><xqdoc:namespace prefix="local" uri="http://www.w3.org/2005/xquery-local-functions"/><xqdoc:namespace prefix="local" uri="http://www.w3.org/2005/xquery-local-functions"/></xqdoc:namespaces><xqdoc:variables><xqdoc:variable><xqdoc:name>base</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:variable><xqdoc:variable><xqdoc:name>src</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:variable></xqdoc:variables><xqdoc:functions><xqdoc:function arity="2"><xqdoc:name>local:resolve</xqdoc:name><xqdoc:signature>declare function local:resolve($path as item()*, $base as item()*) as item()*</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>path</xqdoc:name><xqdoc:type occurrence="*">item()</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>base</xqdoc:name><xqdoc:type occurrence="*">item()</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:string</xqdoc:type></xqdoc:return><xqdoc:invoked arity="2"><xqdoc:uri>http://expath.org/ns/file</xqdoc:uri><xqdoc:name>resolve-path</xqdoc:name></xqdoc:invoked><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>path</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>base</xqdoc:name></xqdoc:ref-variable><xqdoc:body>function local:resolve($path,$base){
  file:resolve-path($path,$base)
}</xqdoc:body></xqdoc:function><xqdoc:function arity="0"><xqdoc:comment><xqdoc:description>pseudo main function</xqdoc:description></xqdoc:comment><xqdoc:name>local:xqDoc-main</xqdoc:name><xqdoc:signature>local:xqDoc-main()</xqdoc:signature><xqdoc:body>let $ip:=file:list($src,false(), "*.xml")
let $ip:=subsequence($ip,1,10)!doc(concat($src,.))
let $d:=
&lt;root xmlns="http://quodatum.com/ns/pipeline"&gt;
 &lt;xslt href="{ local:resolve('08S3-to-rosetta-legdoc.xsl',$base) }"/&gt;
 &lt;validate href="{ local:resolve('legdoc-norm.dtd',$base) }" type="dtd" failOnError="true"/&gt;
 &lt;store base="c:\tmp\" fileExpression="'a' || $position || '.xml'" dated="true"/&gt;
&lt;/root&gt;

 return qipe:run($d,$ip)</xqdoc:body><xqdoc:invoked arity="3"><xqdoc:uri>http://expath.org/ns/file</xqdoc:uri><xqdoc:name>list</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>false</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="3"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>subsequence</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>doc</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>concat</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xquery-local-functions</xqdoc:uri><xqdoc:name>resolve</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xquery-local-functions</xqdoc:uri><xqdoc:name>resolve</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://quodatum.com/ns/pipeline</xqdoc:uri><xqdoc:name>run</xqdoc:name></xqdoc:invoked><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>src</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>ip</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>src</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>base</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>base</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>d</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>ip</xqdoc:name></xqdoc:ref-variable><xqdoc:body>let $ip:=file:list($src,false(), "*.xml")
let $ip:=subsequence($ip,1,10)!doc(concat($src,.))
let $d:=
&lt;root xmlns="http://quodatum.com/ns/pipeline"&gt;
 &lt;xslt href="{ local:resolve('08S3-to-rosetta-legdoc.xsl',$base) }"/&gt;
 &lt;validate href="{ local:resolve('legdoc-norm.dtd',$base) }" type="dtd" failOnError="true"/&gt;
 &lt;store base="c:\tmp\" fileExpression="'a' || $position || '.xml'" dated="true"/&gt;
&lt;/root&gt;

 return qipe:run($d,$ip)</xqdoc:body></xqdoc:function></xqdoc:functions></xqdoc:xqdoc>