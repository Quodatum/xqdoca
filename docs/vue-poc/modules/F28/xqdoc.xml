<xqdoc:xqdoc xmlns:xqdoc="http://www.xqdoc.org/1.0"><xqdoc:control><xqdoc:date>2019-06-06T22:42:08.709+01:00</xqdoc:date><xqdoc:version>1.1</xqdoc:version></xqdoc:control><xqdoc:module type="main"><xqdoc:uri>tx-model.xq</xqdoc:uri><xqdoc:comment><xqdoc:description>Update `generated/models.xqm` from XML files in `data/models`</xqdoc:description></xqdoc:comment><xqdoc:body>(:~
 : Update `generated/models.xqm` from XML files in `data/models`
 :)

import module namespace bf = 'quodatum.tools.buildfields' at "./../../../lib/entity-gen.xqm";

(:~ 
 : Folder containing model definitions as xml
 : @default C:/Users/andy/git/vue-poc/src/vue-poc/models/entities
 :)
declare variable $efolder as xs:anyURI  external 
:=xs:anyURI("C:/Users/andy/git/vue-poc/src/vue-poc/models/entities");

(:~ 
 : Path to xqm file to generate
 : @default C:/Users/andy/git/vue-poc/src/vue-poc/models.gen.xqm
 :)
declare variable $target as xs:anyURI  external 
:=xs:anyURI("C:/Users/andy/git/vue-poc/src/vue-poc/models.gen.xqm");


let $config:='import module namespace cfg = "quodatum:media.image.configure" at "features/images/config.xqm";'
let $src:=bf:module(bf:entities($efolder),$config)
return (
  prof:variables(),
  file:write-text($target,$src),
  update:output(&lt;json type="object"&gt;&lt;msg&gt;Updated: {$target}&lt;/msg&gt;&lt;/json&gt;)
)
       
</xqdoc:body></xqdoc:module><xqdoc:imports><xqdoc:import type="library"><xqdoc:uri>quodatum.tools.buildfields</xqdoc:uri></xqdoc:import></xqdoc:imports><xqdoc:namespaces><xqdoc:namespace prefix="bf" uri="quodatum.tools.buildfields"/><xqdoc:namespace prefix="local" uri="http://www.w3.org/2005/xquery-local-functions"/></xqdoc:namespaces><xqdoc:variables><xqdoc:variable><xqdoc:name>efolder</xqdoc:name><xqdoc:comment><xqdoc:description>Folder containing model definitions as xml</xqdoc:description><xqdoc:custom tag="default">C:/Users/andy/git/vue-poc/src/vue-poc/models/entities</xqdoc:custom></xqdoc:comment><xqdoc:type>xs:anyURI</xqdoc:type></xqdoc:variable><xqdoc:variable><xqdoc:name>target</xqdoc:name><xqdoc:comment><xqdoc:description>Path to xqm file to generate</xqdoc:description><xqdoc:custom tag="default">C:/Users/andy/git/vue-poc/src/vue-poc/models.gen.xqm</xqdoc:custom></xqdoc:comment><xqdoc:type>xs:anyURI</xqdoc:type></xqdoc:variable></xqdoc:variables><xqdoc:functions><xqdoc:function arity="0"><xqdoc:comment><xqdoc:description>pseudo main function</xqdoc:description></xqdoc:comment><xqdoc:name>local:xqDoc-main</xqdoc:name><xqdoc:signature>local:xqDoc-main()</xqdoc:signature><xqdoc:body>let $config:='import module namespace cfg = "quodatum:media.image.configure" at "features/images/config.xqm";'
let $src:=bf:module(bf:entities($efolder),$config)
return (
  prof:variables(),
  file:write-text($target,$src),
  update:output(&lt;json type="object"&gt;&lt;msg&gt;Updated: {$target}&lt;/msg&gt;&lt;/json&gt;)
)</xqdoc:body><xqdoc:invoked arity="2"><xqdoc:uri>quodatum.tools.buildfields</xqdoc:uri><xqdoc:name>module</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>quodatum.tools.buildfields</xqdoc:uri><xqdoc:name>entities</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://basex.org/modules/prof</xqdoc:uri><xqdoc:name>variables</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://expath.org/ns/file</xqdoc:uri><xqdoc:name>write-text</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://basex.org/modules/update</xqdoc:uri><xqdoc:name>output</xqdoc:name></xqdoc:invoked><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>efolder</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>config</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>target</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>src</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>target</xqdoc:name></xqdoc:ref-variable><xqdoc:body>let $config:='import module namespace cfg = "quodatum:media.image.configure" at "features/images/config.xqm";'
let $src:=bf:module(bf:entities($efolder),$config)
return (
  prof:variables(),
  file:write-text($target,$src),
  update:output(&lt;json type="object"&gt;&lt;msg&gt;Updated: {$target}&lt;/msg&gt;&lt;/json&gt;)
)</xqdoc:body></xqdoc:function></xqdoc:functions></xqdoc:xqdoc>