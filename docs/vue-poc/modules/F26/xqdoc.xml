<xqdoc:xqdoc xmlns:xqdoc="http://www.xqdoc.org/1.0"><xqdoc:control><xqdoc:date>2019-05-29T12:58:24.547+01:00</xqdoc:date><xqdoc:version>1.1</xqdoc:version></xqdoc:control><xqdoc:module type="library"><xqdoc:uri>quodatum.test.ping</xqdoc:uri><xqdoc:name>ping.xqm</xqdoc:name><xqdoc:comment><xqdoc:description>Simple server performance test</xqdoc:description><xqdoc:custom tag="__source">features/server/ping.xqm</xqdoc:custom></xqdoc:comment><xqdoc:body>xquery version "3.1";
(:~
 : Simple server performance test
 :)
module namespace ping = 'quodatum.test.ping';
declare variable $ping:db as xs:string:="vue-poc";
declare %basex:lazy variable $ping:state as element(state):=db:open($ping:db,"/state.xml")/state;

(:~
 :  incr counter
 :)
declare %updating  
%rest:POST %rest:path("/vue-poc/api/ping")
%output:method("text")
function ping:dopost()
{
    (replace value of node $ping:state/ping with 1+$ping:state/ping,
            update:output(1+$ping:state/ping))
};

(:~
 :  read counter
 :)
declare 
%output:method("text")  
%rest:GET %rest:path("/vue-poc/api/ping")
function ping:dostate()
{
  $ping:state/ping
};

(:~
 :  return simple constant
 :)
declare 
%output:method("text")  
%rest:GET %rest:path("/vue-poc/api/nodb")
function ping:nodb()
{
  "ok"
};</xqdoc:body></xqdoc:module><xqdoc:imports/><xqdoc:namespaces><xqdoc:namespace prefix="ping" uri="quodatum.test.ping"/><xqdoc:namespace prefix="basex" uri="http://basex.org"/><xqdoc:namespace prefix="ann" uri="http://www.w3.org/2012/xquery"/><xqdoc:namespace prefix="rest" uri="http://exquery.org/ns/restxq"/><xqdoc:namespace prefix="output" uri="http://www.w3.org/2010/xslt-xquery-serialization"/></xqdoc:namespaces><xqdoc:variables><xqdoc:variable><xqdoc:name>ping:db</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:variable><xqdoc:variable><xqdoc:name>ping:state</xqdoc:name><xqdoc:annotations><xqdoc:annotation name="basex:lazy"/></xqdoc:annotations><xqdoc:type>element(state)</xqdoc:type></xqdoc:variable></xqdoc:variables><xqdoc:functions><xqdoc:function arity="0"><xqdoc:comment><xqdoc:description>incr counter</xqdoc:description></xqdoc:comment><xqdoc:name>ping:dopost</xqdoc:name><xqdoc:annotations><xqdoc:annotation name="updating"/><xqdoc:annotation name="rest:POST"/><xqdoc:annotation name="rest:path"><xqdoc:literal type="xs:string">/vue-poc/api/ping</xqdoc:literal></xqdoc:annotation><xqdoc:annotation name="output:method"><xqdoc:literal type="xs:string">text</xqdoc:literal></xqdoc:annotation></xqdoc:annotations><xqdoc:signature>declare %updating %rest:POST %rest:path("/vue-poc/api/ping") %output:method("text") function ping:dopost() as item()*</xqdoc:signature><xqdoc:return><xqdoc:type occurrence="*">item()</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://basex.org/modules/update</xqdoc:uri><xqdoc:name>output</xqdoc:name></xqdoc:invoked><xqdoc:ref-variable><xqdoc:uri>quodatum.test.ping</xqdoc:uri><xqdoc:name>state</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>quodatum.test.ping</xqdoc:uri><xqdoc:name>state</xqdoc:name></xqdoc:ref-variable><xqdoc:ref-variable><xqdoc:uri>quodatum.test.ping</xqdoc:uri><xqdoc:name>state</xqdoc:name></xqdoc:ref-variable><xqdoc:body>function ping:dopost()
{
    (replace value of node $ping:state/ping with 1+$ping:state/ping,
            update:output(1+$ping:state/ping))
}</xqdoc:body></xqdoc:function><xqdoc:function arity="0"><xqdoc:comment><xqdoc:description>read counter</xqdoc:description></xqdoc:comment><xqdoc:name>ping:dostate</xqdoc:name><xqdoc:annotations><xqdoc:annotation name="output:method"><xqdoc:literal type="xs:string">text</xqdoc:literal></xqdoc:annotation><xqdoc:annotation name="rest:GET"/><xqdoc:annotation name="rest:path"><xqdoc:literal type="xs:string">/vue-poc/api/ping</xqdoc:literal></xqdoc:annotation></xqdoc:annotations><xqdoc:signature>declare %output:method("text") %rest:GET %rest:path("/vue-poc/api/ping") function ping:dostate() as item()*</xqdoc:signature><xqdoc:return><xqdoc:type occurrence="*">item()</xqdoc:type></xqdoc:return><xqdoc:ref-variable><xqdoc:uri>quodatum.test.ping</xqdoc:uri><xqdoc:name>state</xqdoc:name></xqdoc:ref-variable><xqdoc:body>function ping:dostate()
{
  $ping:state/ping
}</xqdoc:body></xqdoc:function><xqdoc:function arity="0"><xqdoc:comment><xqdoc:description>return simple constant</xqdoc:description></xqdoc:comment><xqdoc:name>ping:nodb</xqdoc:name><xqdoc:annotations><xqdoc:annotation name="output:method"><xqdoc:literal type="xs:string">text</xqdoc:literal></xqdoc:annotation><xqdoc:annotation name="rest:GET"/><xqdoc:annotation name="rest:path"><xqdoc:literal type="xs:string">/vue-poc/api/nodb</xqdoc:literal></xqdoc:annotation></xqdoc:annotations><xqdoc:signature>declare %output:method("text") %rest:GET %rest:path("/vue-poc/api/nodb") function ping:nodb() as item()*</xqdoc:signature><xqdoc:return><xqdoc:type>xs:string</xqdoc:type></xqdoc:return><xqdoc:body>function ping:nodb()
{
  "ok"
}</xqdoc:body></xqdoc:function></xqdoc:functions></xqdoc:xqdoc>