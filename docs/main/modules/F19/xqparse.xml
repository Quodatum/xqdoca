<XQuery><Module><VersionDecl><TOKEN>xquery</TOKEN> <TOKEN>version</TOKEN> <StringLiteral>"3.1"</StringLiteral><TOKEN>;</TOKEN></VersionDecl>
(:
 : Copyright (c) 2019 Quodatum Ltd
 :
 : Licensed under the Apache License, Version 2.0 (the "License");
 : you may not use this file except in compliance with the License.
 : You may obtain a copy of the License at
 :
 :     http://www.apache.org/licenses/LICENSE-2.0
 :
 : Unless required by applicable law or agreed to in writing, software
 : distributed under the License is distributed on an "AS IS" BASIS,
 : WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 : See the License for the specific language governing permissions and
 : limitations under the License.
 :)
 
 (:~
 : &lt;h1&gt;check-environment.xq&lt;/h1&gt;
 : &lt;p&gt;Validate dependancies from expath-pkg file &lt;/p&gt;
 :
 : @author Andy Bunce
 : @version 0.2
 :)
 <MainModule><Prolog><NamespaceDecl><TOKEN>declare</TOKEN> <TOKEN>namespace</TOKEN> <NCName>pkg</NCName><TOKEN>=</TOKEN><StringLiteral>"http://expath.org/ns/pkg"</StringLiteral></NamespaceDecl><TOKEN>;</TOKEN>
 <AnnotatedDecl><TOKEN>declare</TOKEN> <VarDecl><TOKEN>variable</TOKEN> <TOKEN>$</TOKEN><QName>pkg</QName><TOKEN>:=</TOKEN><ArrowExpr><FunctionCall><QName>doc</QName><ArgumentList><TOKEN>(</TOKEN><StringLiteral>"expath-pkg.xml"</StringLiteral><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>=&gt;</TOKEN><QName>trace</QName><ArgumentList><TOKEN>(</TOKEN><StringLiteral>"DOC"</StringLiteral><TOKEN>)</TOKEN></ArgumentList></ArrowExpr></VarDecl></AnnotatedDecl><TOKEN>;</TOKEN></Prolog>
(:~
 : raise error if environment incorrect 
 :)
 
  <FLWORExpr><LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>basex</QName><TOKEN>:=</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>pkg</QName></VarRef><TOKEN>/</TOKEN><AxisStep><QName>pkg:package</QName><PredicateList/></AxisStep><TOKEN>/</TOKEN><AxisStep><QName>pkg:dependency</QName><Predicate><TOKEN>[</TOKEN><ComparisonExpr><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>processor</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>=</TOKEN><StringLiteral>"http://basex.org/"</StringLiteral></ComparisonExpr><TOKEN>]</TOKEN></Predicate></AxisStep><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>version</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>/</TOKEN><FunctionCall><QName>string</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></RelativePathExpr></LetBinding></LetClause>
  <LetClause><TOKEN>let</TOKEN> <LetBinding><TOKEN>$</TOKEN><QName>pkgs</QName><TOKEN>:=</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>pkg</QName></VarRef><TOKEN>/</TOKEN><AxisStep><QName>pkg:package</QName><PredicateList/></AxisStep><TOKEN>/</TOKEN><AxisStep><QName>pkg:dependency</QName><Predicate><TOKEN>[</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>name</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>]</TOKEN></Predicate></AxisStep></RelativePathExpr></LetBinding></LetClause>
  <ReturnClause><TOKEN>return</TOKEN> 
  
  <IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN> <ComparisonExpr><RelativePathExpr><FunctionCall><QName>db:system</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>/</TOKEN><AxisStep><QName>generalinformation</QName><PredicateList/></AxisStep><TOKEN>/</TOKEN><AxisStep><QName>version</QName><PredicateList/></AxisStep><TOKEN>/</TOKEN><PostfixExpr><FunctionCall><QName>tokenize</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>.</TOKEN><TOKEN>,</TOKEN><StringLiteral>" "</StringLiteral><TOKEN>)</TOKEN></ArgumentList></FunctionCall><Predicate><TOKEN>[</TOKEN><IntegerLiteral>1</IntegerLiteral><TOKEN>]</TOKEN></Predicate></PostfixExpr></RelativePathExpr> <TOKEN>ne</TOKEN> <VarRef><TOKEN>$</TOKEN><QName>basex</QName></VarRef></ComparisonExpr><TOKEN>)</TOKEN><TOKEN>then</TOKEN> 
       <FunctionCall><QName>error</QName><ArgumentList><TOKEN>(</TOKEN><FunctionCall><QName>xs:QName</QName><ArgumentList><TOKEN>(</TOKEN><StringLiteral>"xpg:version"</StringLiteral><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>,</TOKEN><StringLiteral>"BaseX version not supported"</StringLiteral><TOKEN>)</TOKEN></ArgumentList></FunctionCall>
  <TOKEN>else</TOKEN> <ParenthesizedExpr><TOKEN>(</TOKEN>
         <Expr><FLWORExpr><ForClause><TOKEN>for</TOKEN> <ForBinding><TOKEN>$</TOKEN><QName>p</QName> <TOKEN>in</TOKEN> <VarRef><TOKEN>$</TOKEN><QName>pkgs</QName></VarRef></ForBinding></ForClause>
         <ReturnClause><TOKEN>return</TOKEN> <IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><ComparisonExpr><RelativePathExpr><PostfixExpr><FunctionCall><QName>repo:list</QName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall><Predicate><TOKEN>[</TOKEN><ComparisonExpr><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>name</QName></AbbrevForwardStep><PredicateList/></AxisStep><TOKEN>=</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>p</QName></VarRef><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>name</QName></AbbrevForwardStep><PredicateList/></AxisStep></RelativePathExpr></ComparisonExpr><TOKEN>]</TOKEN></Predicate></PostfixExpr><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>version</QName></AbbrevForwardStep> <PredicateList/></AxisStep></RelativePathExpr><TOKEN>ne</TOKEN> <RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>p</QName></VarRef><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>version</QName></AbbrevForwardStep><PredicateList/></AxisStep></RelativePathExpr></ComparisonExpr><TOKEN>)</TOKEN> <TOKEN>then</TOKEN>
                      <FunctionCall><QName>error</QName><ArgumentList><TOKEN>(</TOKEN><FunctionCall><QName>xs:QName</QName><ArgumentList><TOKEN>(</TOKEN><StringLiteral>"pkg:version"</StringLiteral><TOKEN>)</TOKEN></ArgumentList></FunctionCall><TOKEN>,</TOKEN><RelativePathExpr><VarRef><TOKEN>$</TOKEN><QName>p</QName></VarRef><TOKEN>/</TOKEN><AxisStep><AbbrevForwardStep><TOKEN>@</TOKEN><QName>name</QName></AbbrevForwardStep><PredicateList/></AxisStep></RelativePathExpr><TOKEN>)</TOKEN></ArgumentList></FunctionCall> <TOKEN>else</TOKEN> <ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></IfExpr></ReturnClause></FLWORExpr>
    
          <TOKEN>,</TOKEN><StringLiteral>"xqDocA dependancies are all installed."</StringLiteral></Expr>
        <TOKEN>)</TOKEN></ParenthesizedExpr></IfExpr></ReturnClause></FLWORExpr></MainModule></Module>
      

<EOF/></XQuery>