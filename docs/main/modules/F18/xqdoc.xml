<xqdoc:xqdoc xmlns:xqdoc="http://www.xqdoc.org/1.0"><xqdoc:control><xqdoc:date>2019-06-05T22:42:46.34+01:00</xqdoc:date><xqdoc:version>1.1</xqdoc:version></xqdoc:control><xqdoc:module type="library"><xqdoc:uri>quodatum:xqdoca.page</xqdoc:uri><xqdoc:name>xqdoc-page.xqm</xqdoc:name><xqdoc:comment><xqdoc:description><h1>xqdoc-links.xqm</h1>
<p>html utilities</p></xqdoc:description><xqdoc:author>Andy Bunce</xqdoc:author><xqdoc:version>0.1</xqdoc:version><xqdoc:custom tag="__source">lib/xqdoc-page.xqm</xqdoc:custom></xqdoc:comment><xqdoc:body>xquery version "3.1";
(:
 : Copyright (c) 2019 Quodatum Ltd
 :
 : Licensed under the Apache License, Version 2.0 (the "License");
 : you may not use this file except in compliance with the License.
 : You may obtain a copy of the License at
 :
 :     http://www.apache.org/licenses/LICENSE-2.0
 :
 : Unless required by applicable law or agreed to in writing, software
 : distributed under the License is distributed on an "AS IS" BASIS,
 : WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 : See the License for the specific language governing permissions and
 : limitations under the License.
 :)
 
 (:~
 : &lt;h1&gt;xqdoc-links.xqm&lt;/h1&gt;
 : &lt;p&gt;html utilities&lt;/p&gt;
 :
 : @author Andy Bunce
 : @version 0.1
 :)
 

module namespace page = 'quodatum:xqdoca.page';
import module namespace xqn = 'quodatum:xqdoca.namespaces' at "xqdoc-namespace.xqm";

(:~ make html hrefable id :)
declare function page:id($id as xs:string)
as xs:string
{
 "ID_" || escape-html-uri($id)
};

(:~
 : generate link to module with namespace 
 :)
 declare function page:link-module($uri as xs:string,$model as map(*))                       
as element(span)
{
 let $files:=$model?files[?namespace=$uri]
 let $root:="../../"
 return if(empty($files)) then
           &lt;span class="badge badge-warning" title="Externally defined"&gt;{ $uri }&lt;/span&gt;
        else
           &lt;span&gt;
           &lt;a href="{ $root }{ $files[1]?href }index.html" title="{ $files[1]?path }"&gt;{ $files[1]?namespace }&lt;/a&gt;
           {for $file at $pos in tail($files)
           return ("&amp;#160;",
                &lt;a  href="{ $root }{ $file?href }index.html" title="{ $file?path }"&gt;
                &lt;span class="badge badge-info"&gt;{1+$pos}&lt;/span&gt;
                &lt;/a&gt;
                )
         }&lt;/span&gt; 
};

(:~ link to module :)
declare 
function page:link-module($file as map(*))                       
as element(span)
{  
   &lt;span&gt;
    &lt;a href="{ $file?href }index.html" title="{ $file?path }"&gt;{ $file?namespace }&lt;/a&gt; 
   &lt;/span&gt;
};

(:~ link to fun or var in file
 : @param name of form 'fun#arity or '$name' 
:)
declare 
function page:link-function($uri as xs:string,
                            $name as xs:string,
                            $file as map(*),
                            $model as map(*))                       
as element(span)
{  
   let $files:= $model?files[?namespace=$uri]
   let $clark:= xqn:clark-name($uri,$name)
   let $pname:= xqn:prefixed-name($uri,$name,$file?prefixes)
   let $root:="../../"
   return if(empty($files)) then
           &lt;span class="badge badge-warning" title="Externally defined"&gt;{ $clark }&lt;/span&gt;
        else
           let $file:=head($files)
           return &lt;span&gt;
            &lt;a href="{ $root }{ $file?href }index.html#{ $clark }" title="{ $file?path }"&gt;{ $pname }&lt;/a&gt; 
           &lt;/span&gt;
};

(:~  link to restxq view
 : @todo only if generated
 :)
declare 
function page:link-restxq($method as xs:string,
                          $fromModule as xs:boolean
                            )                       
as element(span)
{  
 let $root:=if($fromModule) then "../../" else ""
  return  &lt;span&gt;&lt;a href="{ $root }restxq.html?"&gt;{ page:badge-method($method)}&lt;/a&gt;&lt;/span&gt;
};
 
(:~ link to fun or var in file
 : @param name of form 'fun#arity' or ''$name' 
 : @param fromModule where called from
:)
declare 
function page:link-function2($uri as xs:string,
                             $name as xs:string,
                             $file as map(*),
                             $fromModule as xs:boolean
                           )                       
as element(span)
{  
   let $clark:= xqn:clark-name($uri,$name)
   let $pname:= xqn:prefixed-name($uri,$name,$file?prefixes)
   let $root:=if($fromModule) then "../../" else ""
   return  &lt;span&gt;
            &lt;a href="{ $root }{ $file?href }index.html#{ $clark }" title="{ $file?path }"&gt;{ $pname }&lt;/a&gt; 
           &lt;/span&gt;
};



declare function page:badge-method($method as xs:string)
as element(span)
{
      &lt;span class="badge op-{ lower-case($method) }"&gt;{ $method }&lt;/span&gt;
};

(:~
 :  connections 3 column list 
 :)
declare function page:calls($calls-this as item()*,$this,$called-by-this as item()*)
as element(div)?
{
  if(0=count($calls-this) and 0=count($called-by-this))then ()
  else 
      &lt;div style="display: flex;width:100%; justify-content: space-between;"&gt;
        &lt;div style="width:40%;"&gt;{ if (count($calls-this)) then
                                     $calls-this!&lt;div style="text-align: right;" &gt;{.}&lt;/div&gt;
                                  else "(None)"   
      }&lt;/div&gt;
                      
     &lt;div style="display: flex; flex-direction: column; justify-content: center;"&gt;
         &lt;div&gt;&lt;div&gt;imports&lt;/div&gt;&amp;#x2192;&lt;/div&gt;
        &lt;div class="badge badge-info"&gt;this&lt;/div&gt;
        &lt;div&gt;&lt;div&gt;imports&lt;/div&gt;&amp;#x2192;&lt;/div&gt;
     &lt;/div&gt;
     
    &lt;div style="width:40%;"&gt;{ if(count($called-by-this)) then
                                $called-by-this!&lt;div&gt;{.}&lt;/div&gt;
                              else
                               ("(None)")
     }&lt;/div&gt;
&lt;/div&gt; 
};

(:~ 
 : generate standard page wrapper
 : uses $opts?resources
  :)
declare function page:wrap($body,$opts as map(*)) 
as element(html)
{
  let $resources:=page:resource-path($opts)
  return
    &lt;html&gt;
      &lt;head&gt;
       &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /&gt;
       &lt;meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/&gt; 
       &lt;meta http-equiv="Generator" content="xqdoca - https://github.com/quodatum/xqdoca" /&gt;
        &lt;title&gt;
          { $opts?project } - xqDocA
        &lt;/title&gt;
        
        &lt;link rel="shortcut icon" type="image/x-icon" href="{ $resources }xqdoc.png" /&gt;
        &lt;link rel="stylesheet" type="text/css" href="{ $resources }prism.css"/&gt;
        &lt;link rel="stylesheet" type="text/css" href="{ $resources }page.css" /&gt;
        &lt;link rel="stylesheet" type="text/css" href="{ $resources }query.css" /&gt;
        &lt;link rel="stylesheet" type="text/css" href="{ $resources }base.css" /&gt;
     
      
      &lt;/head&gt;

      &lt;body class="home" id="top"&gt;
        &lt;div id="main" &gt;
        {$body}
        &lt;/div&gt;
        &lt;div class="footer"&gt;
            &lt;p style="text-align:right"&gt;Generated by 
            &lt;a href="https://github.com/Quodatum/xqdoca" target="_blank"&gt;xqDocA&lt;/a&gt; 
            at { page:date() }&lt;/p&gt;
          &lt;/div&gt;
         &lt;script  src="{ $resources }prism.js" type="text/javascript"&gt; &lt;/script&gt;
       
      &lt;/body&gt;
    &lt;/html&gt;
};

declare function page:resource-path($opts as map(*))
as xs:string
{
  if(map:contains($opts,"resources")) then $opts?resources else  "resources/"
};

(:~ 
 : build toc 
 : @param $name title
 : @param $tree xml 
 : @param $decorate function called on leafs
 :)
declare function page:toc3($head as item(),$tree as element(directory),$decorate as function(*))
as element(nav)
{
    &lt;nav id="toc"&gt;
            &lt;h2&gt;
                &lt;a id="contents"&gt;&lt;/a&gt;              
                   { $head }
            &lt;/h2&gt;
            &lt;ol class="toc"&gt;{
             $tree/*! page:tree-list(.,position(),$decorate)
          }&lt;/ol&gt;
        &lt;/nav&gt; 
};

(:~  section numbering util return dott joined string :)
declare function page:section($pos as xs:anyAtomicType*)
as xs:string{
  string-join($pos,".") || "&amp;#160;"
};

(:~ tree to list
 : @param tree file (@name.@target) directory elements 
 : @param $seq  section number as sequence of levels
:)
declare function page:tree-list($tree as element(*),$seq as xs:integer*,$render as function(*))
as element(li){
  let $pos:=page:section($seq)
  
  return &lt;li&gt;{
         $render($pos,$tree),
         if($tree  instance of element(directory))then
          &lt;ol &gt;{ $tree/*!page:tree-list(.,($seq,position()),$render) }&lt;/ol&gt;
          else ()
        }&lt;/li&gt;
 
};

(:~ 
 : simple toc render 
 : @see tree-list
 :)
declare function page:toc-render($pos as xs:string,$el as element(*))
as element(*)
{
let $c:=(
&lt;span class="secno"&gt;{$pos}&lt;/span&gt;,
&lt;span class="content"&gt;{$el/@name/string()}&lt;/span&gt;
)
return if($el/@target) then
 &lt;a href="{$el/@target}"&gt;{ $c }&lt;/a&gt;
else
 &lt;span&gt;{$c}&lt;/span&gt;
};

(:~ formated datetime
 : @param $when date to now
 :)
declare function page:date($when as xs:dateTime)
as element(span)
{
  &lt;span title="{ $when }" &gt;{ format-dateTime($when, "[h].[m01][Pn] on [FNn], [MNn] [D1o] [Y0000]") }&lt;/span&gt;
};

(:~ formated datetime for now :)
declare function page:date()
as element(span)
{
 page:date(current-dateTime())
};

(:~ table of renderers
 : @param type global or module
 
 :)
declare 
function page:view-list($type as xs:string,
                        $opts as map(*),
                        $exclude as xs:string*)                       
as element(table)?
{
 let $selected:=$opts?outputs?($type)
 let $renderers:=$opts(".renderers")?($type)
 let $list:=page:tokens($selected)[not(. = $exclude)]
 return if(not(empty($list))) then
           &lt;table class="data"&gt;
                 &lt;thead&gt;
                 &lt;th&gt;View&lt;/th&gt;
                 &lt;th&gt;Description&lt;/th&gt;
                 &lt;th&gt;Format&lt;/th&gt;
                 &lt;/thead&gt;
                 &lt;tbody&gt;
                 {
                  for  $name in $list 
                  let $rend :=  $renderers[?name=$name]
                 
                  return (for $def in  $rend
                          order by $def?name
                         return &lt;tr&gt;
                                 &lt;td&gt;&lt;a href="{ $def?uri }"&gt;{ $def?name }&lt;/a&gt;&lt;/td&gt;
                                  &lt;td&gt;{ $def?description }&lt;/td&gt;
                                  &lt;td&gt;{ $def?output }&lt;/td&gt;
                                 &lt;/tr&gt;,
                         if(empty($rend)) then
                               &lt;tr&gt;
                                &lt;td&gt;&lt;span class="badge badge-danger"&gt;{ $name }&lt;/span&gt;&lt;/td&gt;
                                &lt;td&gt;No renderer found&lt;/td&gt;
                               &lt;/tr&gt;
                             )
                  }    
                 &lt;/tbody&gt;
        &lt;/table&gt;
       else
         ()
};

declare function page:module-links($type as xs:string, $exclude as xs:string, $opts as map(*))
as element(details)?
{
let $t:=page:view-list($type, $opts,$exclude)
return if ($t) then
         &lt;details&gt;
            &lt;summary&gt;Other perspectives&lt;/summary&gt;
            {$t}
          &lt;/details&gt;
        else
           ()
};

(:~ 
 : Coloured &lt;span/&gt; as bootstrap badge
 :)
declare function page:badge($label as xs:string,$color as xs:string,$title as xs:string)
as element(span)
{
  &lt;span class="badge badge-{$color}" title="{ $title }"&gt;{$label}&lt;/span&gt;
};

(:~ 
 :true() if $url represents a url
 :@see http://urlregex.com/ 
 :)
declare function page:is-url($url as xs:string)
as xs:boolean
{
  matches($url,"^(https?|ftp|file)://[-a-zA-Z0-9+&amp;amp;@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&amp;amp;@#/%=~_|]","j")
};

(:~ 
 : parse tokens
 :)
 declare function page:tokens($s as xs:string)
 as xs:string*
 {
 $s=&gt;normalize-space()=&gt;tokenize("[\s,]+") 
};</xqdoc:body></xqdoc:module><xqdoc:namespaces><xqdoc:namespace prefix="page" uri="quodatum:xqdoca.page"/><xqdoc:namespace prefix="xqn" uri="quodatum:xqdoca.namespaces"/></xqdoc:namespaces><xqdoc:imports><xqdoc:import type="library"><xqdoc:uri>quodatum:xqdoca.namespaces</xqdoc:uri></xqdoc:import></xqdoc:imports><xqdoc:variables/><xqdoc:functions><xqdoc:function arity="1"><xqdoc:comment><xqdoc:description>make html hrefable id</xqdoc:description></xqdoc:comment><xqdoc:name>page:id</xqdoc:name><xqdoc:signature>declare function page:id($id as xs:string) as xs:string</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>id</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:string</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="2"><xqdoc:comment><xqdoc:description>generate link to module with namespace</xqdoc:description></xqdoc:comment><xqdoc:name>page:link-module</xqdoc:name><xqdoc:signature>declare function page:link-module($uri as xs:string, $model as map(*)) as element(span)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>uri</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>model</xqdoc:name><xqdoc:type>map(*)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element(span)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="1"><xqdoc:comment><xqdoc:description>link to module</xqdoc:description></xqdoc:comment><xqdoc:name>page:link-module</xqdoc:name><xqdoc:signature>declare function page:link-module($file as map(*)) as element(span)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>file</xqdoc:name><xqdoc:type>map(*)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element(span)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="4"><xqdoc:comment><xqdoc:description>link to fun or var in file</xqdoc:description><xqdoc:param>name of form 'fun#arity or '$name'</xqdoc:param></xqdoc:comment><xqdoc:name>page:link-function</xqdoc:name><xqdoc:signature>declare function page:link-function($uri as xs:string, $name as xs:string, $file as map(*), $model as map(*)) as element(span)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>uri</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>name</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>file</xqdoc:name><xqdoc:type>map(*)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>model</xqdoc:name><xqdoc:type>map(*)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element(span)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="2"><xqdoc:comment><xqdoc:description>link to restxq view</xqdoc:description><xqdoc:custom tag="todo">only if generated</xqdoc:custom></xqdoc:comment><xqdoc:name>page:link-restxq</xqdoc:name><xqdoc:signature>declare function page:link-restxq($method as xs:string, $fromModule as xs:boolean) as element(span)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>method</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>fromModule</xqdoc:name><xqdoc:type>xs:boolean</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element(span)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="4"><xqdoc:comment><xqdoc:description>link to fun or var in file</xqdoc:description><xqdoc:param>name of form 'fun#arity' or ''$name'</xqdoc:param><xqdoc:param>fromModule where called from</xqdoc:param></xqdoc:comment><xqdoc:name>page:link-function2</xqdoc:name><xqdoc:signature>declare function page:link-function2($uri as xs:string, $name as xs:string, $file as map(*), $fromModule as xs:boolean) as element(span)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>uri</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>name</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>file</xqdoc:name><xqdoc:type>map(*)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>fromModule</xqdoc:name><xqdoc:type>xs:boolean</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element(span)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="1"><xqdoc:name>page:badge-method</xqdoc:name><xqdoc:signature>declare function page:badge-method($method as xs:string) as element(span)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>method</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element(span)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="3"><xqdoc:comment><xqdoc:description>connections 3 column list</xqdoc:description></xqdoc:comment><xqdoc:name>page:calls</xqdoc:name><xqdoc:signature>declare function page:calls($calls-this as item()*, $this as item()*, $called-by-this as item()*) as element(div)?</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>calls-this</xqdoc:name><xqdoc:type occurrence="*">item()</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>this</xqdoc:name><xqdoc:type occurrence="*">item()</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>called-by-this</xqdoc:name><xqdoc:type occurrence="*">item()</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="?">element(div)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="2"><xqdoc:comment><xqdoc:description>generate standard page wrapper
uses $opts?resources</xqdoc:description></xqdoc:comment><xqdoc:name>page:wrap</xqdoc:name><xqdoc:signature>declare function page:wrap($body as item()*, $opts as map(*)) as element(html)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>body</xqdoc:name><xqdoc:type occurrence="*">item()</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>opts</xqdoc:name><xqdoc:type>map(*)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element(html)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="1"><xqdoc:name>page:resource-path</xqdoc:name><xqdoc:signature>declare function page:resource-path($opts as map(*)) as xs:string</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>opts</xqdoc:name><xqdoc:type>map(*)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:string</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="3"><xqdoc:comment><xqdoc:description>build toc</xqdoc:description><xqdoc:param>$name title</xqdoc:param><xqdoc:param>$tree xml</xqdoc:param><xqdoc:param>$decorate function called on leafs</xqdoc:param></xqdoc:comment><xqdoc:name>page:toc3</xqdoc:name><xqdoc:signature>declare function page:toc3($head as item(), $tree as element(directory), $decorate as function(*)) as element(nav)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>head</xqdoc:name><xqdoc:type>item()</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>tree</xqdoc:name><xqdoc:type>element(directory)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>decorate</xqdoc:name><xqdoc:type>function(*)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element(nav)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="1"><xqdoc:comment><xqdoc:description>section numbering util return dott joined string</xqdoc:description></xqdoc:comment><xqdoc:name>page:section</xqdoc:name><xqdoc:signature>declare function page:section($pos as xs:anyAtomicType*) as xs:string</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>pos</xqdoc:name><xqdoc:type occurrence="*">xs:anyAtomicType</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:string</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="3"><xqdoc:comment><xqdoc:description>tree to list</xqdoc:description><xqdoc:param>tree file (@name.@target) directory elements</xqdoc:param><xqdoc:param>$seq  section number as sequence of levels</xqdoc:param></xqdoc:comment><xqdoc:name>page:tree-list</xqdoc:name><xqdoc:signature>declare function page:tree-list($tree as element(), $seq as xs:integer*, $render as function(*)) as element(li)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>tree</xqdoc:name><xqdoc:type>element()</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>seq</xqdoc:name><xqdoc:type occurrence="*">xs:integer</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>render</xqdoc:name><xqdoc:type>function(*)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element(li)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="2"><xqdoc:comment><xqdoc:description>simple toc render</xqdoc:description><xqdoc:see>tree-list</xqdoc:see></xqdoc:comment><xqdoc:name>page:toc-render</xqdoc:name><xqdoc:signature>declare function page:toc-render($pos as xs:string, $el as element()) as element()</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>pos</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>el</xqdoc:name><xqdoc:type>element()</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element()</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="1"><xqdoc:comment><xqdoc:description>formated datetime</xqdoc:description><xqdoc:param>$when date to now</xqdoc:param></xqdoc:comment><xqdoc:name>page:date</xqdoc:name><xqdoc:signature>declare function page:date($when as xs:dateTime) as element(span)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>when</xqdoc:name><xqdoc:type>xs:dateTime</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element(span)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="0"><xqdoc:comment><xqdoc:description>formated datetime for now</xqdoc:description></xqdoc:comment><xqdoc:name>page:date</xqdoc:name><xqdoc:signature>declare function page:date() as element(span)</xqdoc:signature><xqdoc:return><xqdoc:type>element(span)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="3"><xqdoc:comment><xqdoc:description>table of renderers</xqdoc:description><xqdoc:param>type global or module</xqdoc:param></xqdoc:comment><xqdoc:name>page:view-list</xqdoc:name><xqdoc:signature>declare function page:view-list($type as xs:string, $opts as map(*), $exclude as xs:string*) as element(table)?</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>type</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>opts</xqdoc:name><xqdoc:type>map(*)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>exclude</xqdoc:name><xqdoc:type occurrence="*">xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="?">element(table)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="3"><xqdoc:name>page:module-links</xqdoc:name><xqdoc:signature>declare function page:module-links($type as xs:string, $exclude as xs:string, $opts as map(*)) as element(details)?</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>type</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>exclude</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>opts</xqdoc:name><xqdoc:type>map(*)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="?">element(details)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="3"><xqdoc:comment><xqdoc:description>Coloured <span/> as bootstrap badge</xqdoc:description></xqdoc:comment><xqdoc:name>page:badge</xqdoc:name><xqdoc:signature>declare function page:badge($label as xs:string, $color as xs:string, $title as xs:string) as element(span)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>label</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>color</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>title</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element(span)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="1"><xqdoc:comment><xqdoc:description>true() if $url represents a url</xqdoc:description><xqdoc:see>http://urlregex.com/</xqdoc:see></xqdoc:comment><xqdoc:name>page:is-url</xqdoc:name><xqdoc:signature>declare function page:is-url($url as xs:string) as xs:boolean</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>url</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:boolean</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="1"><xqdoc:comment><xqdoc:description>parse tokens</xqdoc:description></xqdoc:comment><xqdoc:name>page:tokens</xqdoc:name><xqdoc:signature>declare function page:tokens($s as xs:string) as xs:string*</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>s</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="*">xs:string</xqdoc:type></xqdoc:return></xqdoc:function></xqdoc:functions></xqdoc:xqdoc>